

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="j1ya">
  <meta name="keywords" content="">
  
    <meta name="description" content="1byte-&gt;2**n bytes  非对称加密：RSA ECC SM2 SM9 哈希：MD5 SHA SM3 base58（整除）  1byte-&gt;n bytes  分组：SM1 SM4 SM7 base16,32,64,85  1byte-&gt;1 byte  替换密码 RC4 ZUC  base64核心：三转四     补充一下我对倒数第四行的的困惑及解释：字母和3进行与操作只">
<meta property="og:type" content="article">
<meta property="og:title" content="Reverse常见算法">
<meta property="og:url" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/index.html">
<meta property="og:site_name" content="j1ya">
<meta property="og:description" content="1byte-&gt;2**n bytes  非对称加密：RSA ECC SM2 SM9 哈希：MD5 SHA SM3 base58（整除）  1byte-&gt;n bytes  分组：SM1 SM4 SM7 base16,32,64,85  1byte-&gt;1 byte  替换密码 RC4 ZUC  base64核心：三转四     补充一下我对倒数第四行的的困惑及解释：字母和3进行与操作只">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689236059101-693a1652-dd19-464f-9730-cac9a18f55b2.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689236688306-efc39010-7dc0-4bf0-8a7d-49d3922156e8.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689664419744-c0e1d41e-b126-49b8-9a8a-48e0eb368f86.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694240916741-6f8d2997-bcbf-40f6-af75-042c3b24aae3.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1722498705970-3564e836-8165-4298-b3fc-b8ee8d848a81.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689682750988-bfb173d7-d35f-4f0a-bc76-3a0be2c2b817.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689686114595-4174755a-78fb-47f4-9f2a-49b2685a4280.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1707662727122-9584da0c-e567-491b-ab9d-4e95ce14cdd0.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1724145418625-3419bc86-ade4-4d2d-8ab4-0c9287ff8738.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1730958458935-aeab96b1-8b7c-4fc9-9571-ded865d59c3a.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1705325961046-680c058b-ba27-4aa7-97a0-7092a31fa9a1.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1731857724576-3ca1a863-8cf9-4ca5-bac0-53045be9b033.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1707985910721-26f9b574-a04a-4de6-8673-6e54e3769817.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690008868545-fdc00de5-23b1-42c8-8d20-6418580919d6.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690009427677-c6d93718-7ebe-4d87-80b5-a72a179a5c1c.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690009530480-a3c0925f-502d-46a2-8703-74027c4f7452.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690009546418-117deded-2f60-4ed6-bdae-58ead405dd1a.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706086418277-4c776b78-c130-4fb2-8dcd-8136bea929be.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721699971674-0a74c06c-3b18-4598-99d6-184e37ea5562.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721700131232-474c042d-74f2-457d-912f-e311fecaab9c.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690009117330-39bdc891-aba1-4e93-a5e1-9a3187705a95.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690012128070-bb35c99c-29d8-4e75-ae4b-07e7b4245b96.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1711079059952-9a5a9730-8634-4b74-8dd1-b49bc974ceba.jpeg">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690264717940-bec2a882-45fa-45c4-a1c4-23670f7b6ba1.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690264745779-c3d4ad6b-2983-4bd2-aef1-588027847abd.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071400888-30529eea-1dbf-4aed-99b6-19d64f855758.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1727531578705-8594fe2a-08e7-46a4-a7b6-e356c9a8929c.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071541210-ea7a4a4d-ec16-4ba0-9181-4e2d4759b699.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071672214-90ee84c9-fa8b-40b7-8f20-cfbbbfb680a5.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071810598-38955c99-d8a5-4220-bf79-8d787629cae6.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071939493-34bc8cab-2bd7-499c-9561-b8d15aaeee79.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694079312722-d977fff3-3ac0-4f72-bbbe-ed5fa934945b.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694072162715-e2efba05-73c8-471a-96b2-35f24616460c.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694072214847-8f04ca31-871f-49b7-b019-c02f3d928acd.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694078794302-44b2c0af-77ce-4b5e-8ac4-ab7cbe969fde.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694078824080-db4d1e9d-a053-45a6-bab4-85da101f2769.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694072338044-c6e05c74-0d2e-476d-8de2-d0bb36fe6169.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1707701871151-2c6db9da-3ca6-4ad3-b3cc-538572671725.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970015957-e790cc21-69cd-4c27-82ec-04f5e2389777.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693966877726-70617850-e282-48d0-927a-83e303e32eb8.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970069070-387aab7f-cd39-4461-8e4a-c67f1cab217c.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970143998-4b2596b3-2dcb-461a-a779-f18d47a34948.webp">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970353116-2a024378-53db-4237-b495-6291b8c10b6d.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970383717-bf407b4f-9917-4dbc-8818-8a0668643ea6.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693465621018-8c8131a5-a32f-4e3b-9646-220b1bd2a96f.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693465549899-24101ab3-d128-48be-9379-159436b0563b.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1703390912245-342578b0-719a-48dd-ab02-f0418c5681f1.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562401045-5cda2e71-7c6a-4a65-b23c-cc5109d80cc9.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562611018-1bd9f689-6e46-495d-8073-b22fa1ec241c.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562932304-1d1a2e44-0130-42e3-91f5-d3955ad66aaa.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562785506-05ec6741-6080-4994-b558-4e94c3ff83a7.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562801014-54976159-044a-4f28-9e8d-97e10aad8bf9.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700563149721-eaae8489-5f37-4634-8fab-96d0ac2e4308.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700563125986-2126e3dd-4636-4c80-90ae-8e3f636ca6aa.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1707097836461-8a93cae5-dc75-44f6-8fe6-886db0e0db5b.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1714110661316-4c4b6b35-4fe4-40d9-95b9-2f7235ce7517.jpeg">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1714110671642-2aee3dba-bad9-4b34-bad4-6475cf53cd63.jpeg">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103498182-3d0c05cf-4c62-4494-bbc2-b27a572b65a5.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1725501074874-fc0b4761-a24b-4adc-afc3-f4b0b6a3c249.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103402878-be9876fd-04a6-4b39-a984-52ab209107e4.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103416136-af46dec2-60b8-4619-aa55-f6cadad1bd36.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103463789-7bf66485-cad1-4bf6-a032-39ce1dc72964.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103475369-340dd3c5-c871-4c84-bedd-50d61dc77bf7.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706107904227-c3a6d88e-7b48-4070-bd1c-5465956dc73e.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706107881056-e7eac23e-dab4-4df1-b478-42c4ffd3a376.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721799956770-becace1d-55fb-472a-b818-fbd656562907.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721800105335-3a90d6e8-abb9-4ff4-83a7-72424adfddd0.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721800125836-0324cd07-7174-40b2-93bd-d6a3e21527e5.png">
<meta property="article:published_time" content="2025-01-09T03:38:13.000Z">
<meta property="article:modified_time" content="2025-01-09T03:49:36.700Z">
<meta property="article:author" content="j1ya">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://j1ya-22.github.io/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689236059101-693a1652-dd19-464f-9730-cac9a18f55b2.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Reverse常见算法 - j1ya</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"j1ya-22.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"5oPqGOgpqzM186wdJq3YyrcV-gzGzoHsz","app_key":"tdZv3tC3tP1IszSKxEodRe6e","server_url":null,"path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>j1ya</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Reverse常见算法"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-01-09 11:38" pubdate>
          2025年1月9日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          14k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          113 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Reverse常见算法</h1>
            
            
              <div class="markdown-body">
                
                <p>1byte-&gt;2**n bytes</p>
<ul>
<li>非对称加密：RSA ECC SM2 SM9</li>
<li>哈希：MD5 SHA SM3</li>
<li>base58（整除）</li>
</ul>
<p>1byte-&gt;n bytes</p>
<ul>
<li>分组：SM1 SM4 SM7</li>
<li>base16,32,64,85</li>
</ul>
<p>1byte-&gt;1 byte</p>
<ul>
<li>替换密码</li>
<li>RC4 ZUC</li>
</ul>
<h1 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h1><p>核心：三转四</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689236059101-693a1652-dd19-464f-9730-cac9a18f55b2.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689236688306-efc39010-7dc0-4bf0-8a7d-49d3922156e8.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>补充一下我对倒数第四行的的困惑及解释：字母和3进行与操作只保留字母的二进制最后两位，左移4相当于给低四位加0，一共是六位；后半部分直接右移4，相当于只剩4位，两数取或运算后面的数虽然只有4位，但前面可以补0，且一个数跟0进行或运算取决于它自身，所以一共是6位</p>
<p>有时候会是下面的形式，主要一下子没看出来，记录一下。发现&gt;&gt;2和&amp;0x3f还是在的，另外一些用位操作代替了，且对字符串的长度根据%3的余数做了分类</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689664419744-c0e1d41e-b126-49b8-9a8a-48e0eb368f86.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>也有这种位运算之后全是&amp;0x3f的</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694240916741-6f8d2997-bcbf-40f6-af75-042c3b24aae3.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>%3和&#x3D;告诉我下面的也是base64</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1722498705970-3564e836-8165-4298-b3fc-b8ee8d848a81.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h1 id="RC4"><a href="#RC4" class="headerlink" title="RC4"></a>RC4</h1><p>1.先初始化状态向量S（用来作为密钥流生成的种子1）</p>
<p>2.<strong>初始密钥key（由用户输入）</strong>，长度任意,如果输入长度小于256个字节，则进行循环，直到填满k,有时候k用t来表示</p>
<p>3.开始对状态向量S进行置换操作（用来打乱初始种子1）</p>
<p><strong>KSA</strong></p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689682750988-bfb173d7-d35f-4f0a-bc76-3a0be2c2b817.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>4.生成密钥</p>
<p><strong>PGRA</strong></p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1689686114595-4174755a-78fb-47f4-9f2a-49b2685a4280.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>rc4也可以&amp;255(0xff)</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1707662727122-9584da0c-e567-491b-ab9d-4e95ce14cdd0.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p><strong>在rc4中，key通常为初始化函数的中间参数，可以快速找到</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4</span>(<span class="hljs-params">data, key</span>):<br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    out = []<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % <span class="hljs-built_in">len</span>(key)]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br><br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> data:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + S[i]) % <span class="hljs-number">256</span><br>        S[i], S[j] = S[j], S[i]<br>        out.append(char ^ S[(S[i] + S[j]) % <span class="hljs-number">256</span>])<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(out)<br><br><br>data = <span class="hljs-built_in">bytes</span>([<span class="hljs-number">0x25</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0xB2</span>])<br>key = <span class="hljs-built_in">bytes</span>([<span class="hljs-number">0x43</span>]*<span class="hljs-number">18</span>)<br>decrypted = rc4(data, key)<br><span class="hljs-built_in">print</span>(decrypted)<br></code></pre></td></tr></table></figure>

<p>%128的魔改本质上就是8位二进制数组成的密钥变为7位</p>
<h1 id="TEA"><a href="#TEA" class="headerlink" title="TEA"></a>TEA</h1><h2 id="常规"><a href="#常规" class="headerlink" title="常规"></a>常规</h2><p>一种对称算法，它使用64位明文（一组密文，2<em>32位）和128位密钥（一般是4</em>32位）进行加解密</p>
<p>TEA系列算法中均使用一个DELTA常数，但DELTA的值对算法并无什么影响，只是为了避免不良的取值，推荐DELTA的值十六进制值为<strong>0x9e3779B9</strong>，用于保证每一轮加密都不相同</p>
<h3 id="标准加密流程"><a href="#标准加密流程" class="headerlink" title="标准加密流程"></a>标准加密流程</h3><ol>
<li>将明文按64位分组，将每个分组视为一个64位的二进制数，记为V </li>
<li>将128位的密钥分成<strong>4个32位的子密钥</strong>，分别记为K0、K1、K2、K3</li>
<li>将明文分组V分为两个32位的部分，分别记为V0和V1</li>
<li>设定一个32位的常数delta</li>
<li>TEA算法的加密过程包括32轮迭代，每一轮的加密过程如下：</li>
</ol>
<p>  a. 首先，累加器sum被初始化为0</p>
<p>  b. 接着，将delta值加到sum中。delta是一个常数，其值通常为0x9e3779b9，用于增加加密的随机性<br>  c. 然后，将V1左移4位，加上K0，再异或上(V1+sum)和(V1右移5位+K1)的值。得到的结果作为V0的新值<br>  d. 接下来，将V0左移4位，加上K2，再异或上(V0+sum)和(V0右移5位+K3)的值。得到的结果作为V1的新值<br>  e. 重复上述步骤32次，即完成一轮迭代。在每一轮迭代中，V0和V1的值都会被更新，其中V1的更新依赖V0，而V0的更新依赖于V1</p>
<ol>
<li>经过32轮迭代后，得到加密后的密文，记为C0和C1 </li>
<li>将C0和C1按顺序连接起来，得到64位的密文</li>
</ol>
<h3 id="算法注意点"><a href="#算法注意点" class="headerlink" title="算法注意点"></a>算法注意点</h3><p>key一般为加密函数第二个参数，<strong>sum-&#x3D;0x61c88647和sum+&#x3D;0x9e3779b9是等价的</strong></p>
<p>循环里的l和r一般用v0和v1，这样不容易弄混</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0x9e3779b9</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">tea_encrypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>* v, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>* key)</span> &#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> l = v[<span class="hljs-number">0</span>], r = v[<span class="hljs-number">1</span>], sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>        l += (((r &lt;&lt; <span class="hljs-number">4</span>) ^ (r &gt;&gt; <span class="hljs-number">5</span>)) + r) ^ (sum + key[sum &amp; <span class="hljs-number">3</span>]);<br>        sum += DELTA;<br>        r += (((l &lt;&lt; <span class="hljs-number">4</span>) ^ (l &gt;&gt; <span class="hljs-number">5</span>)) + l) ^ (sum + key[(sum &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>]); <br>    &#125;<br>    v[<span class="hljs-number">0</span>] = l;<br>    v[<span class="hljs-number">1</span>] = r;<br>&#125;<br><br><span class="hljs-comment">//利用可逆性将加密过程逆转</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">tea_decrypt</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>* v, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>* key)</span> &#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> l = v[<span class="hljs-number">0</span>], r = v[<span class="hljs-number">1</span>], sum = <span class="hljs-number">0</span>;<br>    sum = DELTA * <span class="hljs-number">32</span>; l<br>    <span class="hljs-title function_">for</span> <span class="hljs-params">(<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)</span> &#123;<br>        r -= (((l &lt;&lt; <span class="hljs-number">4</span>) ^ (l &gt;&gt; <span class="hljs-number">5</span>)) + l) ^ (sum + key[(sum &gt;&gt; <span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>]);<br>        sum -= DELTA;<br>        l -= (((r &lt;&lt; <span class="hljs-number">4</span>) ^ (r &gt;&gt; <span class="hljs-number">5</span>)) + r) ^ (sum + key[sum &amp; <span class="hljs-number">3</span>]);<br>    &#125;<br>    v[<span class="hljs-number">0</span>] = l;<br>    v[<span class="hljs-number">1</span>] = r;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>有些时候伪代码*4但实际上并不需要，因为这时的key是一个字节</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1724145418625-3419bc86-ade4-4d2d-8ab4-0c9287ff8738.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>注意v0和v1到底是int还是unsigned int</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1730958458935-aeab96b1-8b7c-4fc9-9571-ded865d59c3a.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>有多步操作的时候一定要注意写for循环的时候也要逆向，下面每次循环都要进行异或，自然得从后往前逆</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">uint32_t</span> *k)</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> v0 = v[<span class="hljs-number">0</span>], v1 = v[<span class="hljs-number">1</span>], i;<br>    <span class="hljs-type">uint32_t</span> delta = <span class="hljs-number">0x9e3779b9</span>;<br>    <span class="hljs-type">uint32_t</span> sum = delta * <span class="hljs-number">16</span>;<br>    <span class="hljs-type">uint32_t</span> k0 = k[<span class="hljs-number">0</span>], k1 = k[<span class="hljs-number">1</span>], k2 = k[<span class="hljs-number">2</span>], k3 = k[<span class="hljs-number">3</span>];<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)<br>    &#123;<br>        sum -= delta;<br>        v1 -= ((v0 &lt;&lt; <span class="hljs-number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + k3);<br>        v0 -= ((v1 &lt;&lt; <span class="hljs-number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + k1);<br><br>    &#125;<br>    v[<span class="hljs-number">0</span>] = v0; v[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> enc[<span class="hljs-number">10</span>] = &#123;<br>    <span class="hljs-number">0xBC2B4DF9</span>, <span class="hljs-number">0x6213DD13</span>, <span class="hljs-number">0x89FFFCC9</span>, <span class="hljs-number">0x0FC94F7D</span>, <span class="hljs-number">0x526D1D63</span>, <span class="hljs-number">0xE341FD50</span>, <span class="hljs-number">0x97287633</span>, <span class="hljs-number">0x6BF93638</span>, <br>    <span class="hljs-number">0x83143990</span>, <span class="hljs-number">0x1F2CE22C</span><br>    &#125;;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> key[<span class="hljs-number">4</span>] = &#123;<br>    <span class="hljs-number">0x12345678</span>, <span class="hljs-number">0x09101112</span>, <span class="hljs-number">0x13141516</span>, <span class="hljs-number">0x15161718</span><br>    &#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">9</span>; i &gt;= <span class="hljs-number">2</span>; i-=<span class="hljs-number">2</span>)<br>    &#123;<br>        enc[i] ^= enc[<span class="hljs-number">1</span>];<br>        enc[i - <span class="hljs-number">1</span>] ^= enc[<span class="hljs-number">0</span>];<br>        decrypt(enc, key);<br>    &#125;<br>    decrypt(enc, key);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, enc);<br>&#125;<br><span class="hljs-comment">// DASCTF&#123;I4TH0ok_I5S0ooFunny_Isnotit?????&#125;</span><br></code></pre></td></tr></table></figure>

<p>tea算法会有很多魔改的地方，比如循环次数，算法中多异或几个数，下面在tea的前后还实现了交换</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1705325961046-680c058b-ba27-4aa7-97a0-7092a31fa9a1.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>如果算法里面异或i的话里面的循环也要逆着写</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1731857724576-3ca1a863-8cf9-4ca5-bac0-53045be9b033.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="解密脚本"><a href="#解密脚本" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>由于涉及内存指针等问题，大部分用c写</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> v[<span class="hljs-number">2</span>], <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>])</span> &#123;<br>    <span class="hljs-type">uint32_t</span> v0 = v[<span class="hljs-number">0</span>], v1 = v[<span class="hljs-number">1</span>], sum = <span class="hljs-number">0xC6EF3720</span>, delta = <span class="hljs-number">0x9e3779b9</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>        v1 -= ((v0 &lt;&lt; <span class="hljs-number">4</span>) + key[<span class="hljs-number">2</span>]) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">3</span>]);<br>        v0 -= ((v1 &lt;&lt; <span class="hljs-number">4</span>) + key[<span class="hljs-number">0</span>]) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="hljs-number">5</span>) + key[<span class="hljs-number">1</span>]);<br>        sum -= delta;<br>    &#125;<br>    v[<span class="hljs-number">0</span>] = v0;<br>    v[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">uint32_t</span> key[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0x11121314</span>, <span class="hljs-number">0x22232425</span>, <span class="hljs-number">0x33343536</span>, <span class="hljs-number">0x41424344</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> v5[<span class="hljs-number">8</span>] = &#123;<span class="hljs-number">0x38b97e28</span>, <span class="hljs-number">0xb7e510c1</span>, <span class="hljs-number">0xb4b29fae</span>, <span class="hljs-number">0x5593bbd7</span>,<span class="hljs-number">0x3c2e9b9e</span>, <span class="hljs-number">0x1671c637</span>, <span class="hljs-number">0x8f3a8cb5</span>, <span class="hljs-number">0x5116e515</span>&#125;;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i += <span class="hljs-number">2</span>) &#123;<br>        decrypt(&amp;v5[i], key);<br>    &#125;<br>	<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> m = <span class="hljs-number">0</span>; m &lt;= <span class="hljs-number">3</span>; m++) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, (v5[i] &gt;&gt; (<span class="hljs-number">8</span> * m)) &amp; <span class="hljs-number">0xff</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>tea加密的另一种模式</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> v[<span class="hljs-number">2</span>], <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span> &#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">uint32_t</span> v0 = v[<span class="hljs-number">0</span>], v1 = v[<span class="hljs-number">1</span>], delta = <span class="hljs-number">0x61C88747</span>, sum = delta * (<span class="hljs-number">-64</span>);<br>    <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) &#123;<br>        v1 -= (((v0 &lt;&lt; <span class="hljs-number">4</span>) ^ (v0 &gt;&gt; <span class="hljs-number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="hljs-number">11</span>) &amp; <span class="hljs-number">3</span>])^v0;<br>        sum += delta;<br>        v0 -= (((v1 &lt;&lt; <span class="hljs-number">4</span>) ^ (v1 &gt;&gt; <span class="hljs-number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="hljs-number">3</span>])^v1;<br><br>    &#125;<br>    v[<span class="hljs-number">0</span>] = v0; v[<span class="hljs-number">1</span>] = v1;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> k[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0x5377654E</span>,<span class="hljs-number">0x21726174</span>,<span class="hljs-number">0x5377654E</span>,<span class="hljs-number">0x21726174</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> enc[] = &#123;<span class="hljs-number">0xC19EA29C</span>,<span class="hljs-number">0xDC091F87</span>,<span class="hljs-number">0x91F6E33B</span>,<span class="hljs-number">0xF69A5C7A</span>,<span class="hljs-number">0x93529F20</span>,<span class="hljs-number">0x8A5B94E1</span>,<span class="hljs-number">0xF91D069B</span>,<span class="hljs-number">0x23B0E340</span>&#125;;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">8</span>; i+=<span class="hljs-number">2</span>)&#123;<br>        decrypt(&amp;enc[i], k);<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> m = <span class="hljs-number">0</span>; m &lt;= <span class="hljs-number">3</span>; m++) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, (v5[i] &gt;&gt; (<span class="hljs-number">8</span> * m)) &amp; <span class="hljs-number">0xff</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="XTEA"><a href="#XTEA" class="headerlink" title="XTEA"></a>XTEA</h2><p>从做题角度来说差别不大</p>
<h2 id="XXTEA"><a href="#XXTEA" class="headerlink" title="XXTEA"></a>XXTEA</h2><p>相比xtea与tea，xxtea的复杂度更上了一层，subkey的方式变为已进行的轮数的最后两位与delta叠加的最后两位相异或，delta迭代与tea相同，常见是9轮循环，循环里面先q再p，q就是循环的次数，为<strong>6+52&#x2F;(n+1)</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MX (((z &gt;&gt; 5) ^ (y <span class="hljs-string">&lt;&lt; 2)) + ((y &gt;</span>&gt; 3) ^ (z &lt;&lt; 4))) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0x9e3779b9</span><br><br><span class="hljs-comment">//XXTEA 加密，在处理数据流中每个数据时利用了相邻数据，使用MX函数计算加密值</span><br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> * <span class="hljs-title function_">xxtea_uint_encrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> * data, <span class="hljs-type">size_t</span> len, <span class="hljs-type">uint32_t</span> * key)</span> &#123;<br>    <span class="hljs-type">uint32_t</span> n = (<span class="hljs-type">uint32_t</span>)len - <span class="hljs-number">1</span>;<br>    <span class="hljs-type">uint32_t</span> z = data[n], y, p, q = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / (n + <span class="hljs-number">1</span>), sum = <span class="hljs-number">0</span>, e;<br><br>    <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> data;<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">0</span> &lt; q--) &#123;<br>        sum += DELTA;<br>        <span class="hljs-comment">// 根据sum 计算得出0~3中的某一个数值, 用于MX中与p共同作用选择key数组中某个秘钥值</span><br>        e = sum &gt;&gt; <span class="hljs-number">2</span> &amp; <span class="hljs-number">3</span>;<br><br>        <span class="hljs-comment">//遍历每个待加密的数据</span><br>        <span class="hljs-keyword">for</span> (p = <span class="hljs-number">0</span>; p &lt; n; p++) &#123;<br>            <span class="hljs-comment">//z的初值为data[len - 1]，即将数据数组当做是环形队列来处理的，首尾相连，当加密data[0]时，需要用到data[len - 1]，data[0]，data[0 + 1]，以及MX计算返回的的一个加密值，加密值与data[0]相加后达到加密的效果</span><br>            y = data[p + <span class="hljs-number">1</span>];<br>            z = data[p] += MX;<br>        &#125;<br><br>        <span class="hljs-comment">//当加密data[len-1]时，需要用到data[len - 2]，data[len-1]，data[0]，以及MX计算返回的的一个加密值，加密值与data[len-1]相加后达到加密的效果</span><br>        y = data[<span class="hljs-number">0</span>];<br>        z = data[n] += MX;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> * <span class="hljs-title function_">xxtea_uint_decrypt</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> * data, <span class="hljs-type">size_t</span> len, <span class="hljs-type">uint32_t</span> * key)</span> &#123;<br>    <span class="hljs-type">uint32_t</span> n = (<span class="hljs-type">uint32_t</span>)len - <span class="hljs-number">1</span>;<br>    <span class="hljs-type">uint32_t</span> z, y = data[<span class="hljs-number">0</span>], p, q = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / (n + <span class="hljs-number">1</span>), sum = q * DELTA, e;<br><br>    <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> data;<br><br>    <span class="hljs-keyword">while</span> (sum != <span class="hljs-number">0</span>) &#123;<br>        e = sum &gt;&gt; <span class="hljs-number">2</span> &amp; <span class="hljs-number">3</span>;<br><br>        <span class="hljs-keyword">for</span> (p = n; p &gt; <span class="hljs-number">0</span>; p--) &#123;<br>            z = data[p - <span class="hljs-number">1</span>];<br>            y = data[p] -= MX;<br>        &#125;<br><br>        z = data[n];<br>        y = data[<span class="hljs-number">0</span>] -= MX;<br>        sum -= DELTA;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>有些没6+52&#x2F;(n+1)，但还是有其他特征,而且delta也很明显</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1707985910721-26f9b574-a04a-4de6-8673-6e54e3769817.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>下面是运行脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DELTA 0x9e3779b9</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MX (((z&gt;&gt;5^y<span class="hljs-string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">btea</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> *v, <span class="hljs-type">int</span> n, <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> key[<span class="hljs-number">4</span>])</span> &#123;<br>    <span class="hljs-type">uint32_t</span> y, z, sum;<br>    <span class="hljs-type">unsigned</span> p, rounds, e;<br>    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">1</span>) &#123; <span class="hljs-comment">//加密函数</span><br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>        sum = <span class="hljs-number">0</span>;<br>        z = v[n - <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">do</span> &#123;<br>            sum += DELTA;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = <span class="hljs-number">0</span>; p &lt; n - <span class="hljs-number">1</span>; p++) &#123;<br>                y = v[p + <span class="hljs-number">1</span>];<br>                z = v[p] += MX;<br>            &#125;<br>            y = v[<span class="hljs-number">0</span>];<br>            z = v[n - <span class="hljs-number">1</span>] += MX;<br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">-1</span>) &#123;  <span class="hljs-comment">//解密函数</span><br>        n = -n;<br>        rounds = <span class="hljs-number">6</span> + <span class="hljs-number">52</span> / n;<br>        sum = rounds * DELTA;<br>        y = v[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">do</span> &#123;<br>            e = (sum &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">3</span>;<br>            <span class="hljs-keyword">for</span> (p = n - <span class="hljs-number">1</span>; p &gt; <span class="hljs-number">0</span>; p--) &#123;<br>                z = v[p - <span class="hljs-number">1</span>];<br>                y = v[p] -= MX;<br>            &#125;<br>            z = v[n - <span class="hljs-number">1</span>];<br>            y = v[<span class="hljs-number">0</span>] -= MX;<br>            sum -= DELTA;<br>        &#125; <span class="hljs-keyword">while</span> (--rounds);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">uint32_t</span> v[<span class="hljs-number">9</span>] = &#123;<span class="hljs-number">689085350</span>, <span class="hljs-number">626885696</span>, <span class="hljs-number">1894439255</span>, <span class="hljs-number">1204672445</span>, <span class="hljs-number">1869189675</span>, <span class="hljs-number">475967424</span>, <span class="hljs-number">1932042439</span>, <span class="hljs-number">1280104741</span>, <span class="hljs-number">2808893494</span>&#125;;<br>    <span class="hljs-type">uint32_t</span> <span class="hljs-type">const</span> k[<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">12345678</span>, <span class="hljs-number">12398712</span>, <span class="hljs-number">91283904</span>, <span class="hljs-number">12378192</span>&#125;;<br>    <span class="hljs-type">int</span> n = <span class="hljs-number">9</span>;<br>    btea(v, -n, k);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">9</span>; i ++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v[i] &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v[i] &gt;&gt; <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v[i] &gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v[i] &gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>import base64<br>from ctypes import *<br><br>enc=<span class="hljs-string">&quot;F8URvwNjuAYMN6GVXvgJE1Oe2ULWWow0WThUe0k95xTg60OY&quot;</span><br>data=<span class="hljs-built_in">list</span>(base64.b64decode(enc))<br>enc=[<span class="hljs-type">int</span>.from_bytes(data[i:i + <span class="hljs-number">4</span>], <span class="hljs-string">&quot;little&quot;</span>) <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">0</span>,len(data),<span class="hljs-number">4</span>)]<br>key=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(ord,<span class="hljs-string">&quot;0M21I908n117gC1~&quot;</span>))<br>key=[<span class="hljs-type">int</span>.from_bytes(key[i:i + <span class="hljs-number">4</span>], <span class="hljs-string">&quot;little&quot;</span>) <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">0</span>,len(key),<span class="hljs-number">4</span>)]<br><br><br>def MX(z, y, sum1, k, p, e):<br>    <span class="hljs-keyword">return</span>   c_uint32(((z.value&gt;&gt;<span class="hljs-number">5</span>^y.value&lt;&lt;<span class="hljs-number">2</span>)+(y.value&gt;&gt;<span class="hljs-number">3</span>^z.value&lt;&lt;<span class="hljs-number">4</span>))^((sum1.value^y.value)+(k[(p&amp;<span class="hljs-number">3</span>)^e.value]^z.value)))<br>def btea(v,k,n,delta):<br><br>    <span class="hljs-keyword">if</span> n&gt;<span class="hljs-number">1</span>:<br>        sum1=c_uint32(<span class="hljs-number">0</span>)<br>        z=c_uint32(v[n<span class="hljs-number">-1</span>])<br>        rounds=<span class="hljs-number">6</span>+<span class="hljs-number">52</span><span class="hljs-comment">//n</span><br>        e=c_uint32(<span class="hljs-number">0</span>)<br><br>        <span class="hljs-keyword">while</span> rounds&gt;<span class="hljs-number">0</span>:<br>            sum1.value+=delta<br>            e.value=((sum1.value&gt;&gt;<span class="hljs-number">2</span>)&amp;<span class="hljs-number">3</span>)<br>            <span class="hljs-keyword">for</span> p in range(n<span class="hljs-number">-1</span>):<br>                y=c_uint32(v[p+<span class="hljs-number">1</span>])<br>                v[p] = c_uint32(v[p] + MX(z,y,sum1,k,p,e).value).value<br>                z.value=v[p]<br><br>            y=c_uint32(v[<span class="hljs-number">0</span>])<br>            v[n<span class="hljs-number">-1</span>] = c_uint32(v[n<span class="hljs-number">-1</span>] + MX(z,y,sum1,k,n<span class="hljs-number">-1</span>,e).value).value<br>            z.value=v[n<span class="hljs-number">-1</span>]<br>            rounds-=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        sum1=c_uint32(<span class="hljs-number">0</span>)<br>        n=-n<br>        rounds=<span class="hljs-number">6</span>+<span class="hljs-number">52</span><span class="hljs-comment">//(n+1)</span><br>        sum1.value=rounds*delta<br>        y=c_uint32(v[<span class="hljs-number">0</span>])<br>        e=c_uint32(<span class="hljs-number">0</span>)<br><br>        <span class="hljs-keyword">while</span> rounds&gt;<span class="hljs-number">0</span>:<br>            e.value=((sum1.value&gt;&gt;<span class="hljs-number">2</span>)&amp;<span class="hljs-number">3</span>)<br>            <span class="hljs-keyword">for</span> p in range(n<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>):<br>                z=c_uint32(v[p<span class="hljs-number">-1</span>])<br>                v[p] = c_uint32(v[p] - MX(z,y,sum1,k,p,e).value).value<br>                y.value=v[p]<br><br>            z=c_uint32(v[n<span class="hljs-number">-1</span>])<br>            v[<span class="hljs-number">0</span>] = c_uint32(v[<span class="hljs-number">0</span>] - MX(z,y,sum1,k,<span class="hljs-number">0</span>,e).value).value<br>            y.value=v[<span class="hljs-number">0</span>]<br>            sum1.value-=delta<br>            rounds-=<span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> v<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    a=enc<br>    k= key<br>    delta=<span class="hljs-number">0x9e3779b9</span><br>    n=len(a)<br>    res=btea(a,k,-n,delta)<br>    flag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-string">    import libnum</span><br><span class="hljs-string">    for i in res:</span><br><span class="hljs-string">        flag+=(libnum.n2s(i)[::-1].decode())</span><br><span class="hljs-string">    print(&quot;ISCC&#123;&quot;+flag.strip()+&quot;&#125;&quot;)</span><br></code></pre></td></tr></table></figure>

<h1 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h1><p>参考链接： <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/78913397">https://zhuanlan.zhihu.com/p/78913397</a></p>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><p>AES算法主要有四种操作处理，分别是密钥加法层、字节代换层、行位移层、列混淆层。而明文x和密钥k都是由16个字节组成的数据</p>
<p>AES算法在处理的轮数上只有最后一轮操作与前面的轮处理上有些许不同，在轮处理开始前还单独进行了一次轮密钥加的处理。在处理轮数上，我们只考虑<strong>128位密钥的10轮处理</strong></p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690008868545-fdc00de5-23b1-42c8-8d20-6418580919d6.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="字节代换"><a href="#字节代换" class="headerlink" title="字节代换"></a>字节代换</h3><p>S_box表是通过某种方法计算出来的。S_box表是一个拥有256个字节元素的数组，可以将其定义为一维数组，也可以将其定义为16×16的二维数组，如果将其定义为二维数组，读取S_box数据的方法就是要将输入数据的<strong>每个字节的高四位作为第一个下标，低四位作为第二个下标</strong>，<strong>从s盒中取出并赋给字符</strong></p>
<p>s盒和逆s盒</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> S[<span class="hljs-number">256</span>] = &#123;<br><span class="hljs-number">0x63</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x76</span>,<br><span class="hljs-number">0xCA</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0xC0</span>,<br><span class="hljs-number">0xB7</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x15</span>,<br><span class="hljs-number">0x04</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x75</span>,<br><span class="hljs-number">0x09</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x84</span>,<br><span class="hljs-number">0x53</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xCF</span>,<br><span class="hljs-number">0xD0</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xA8</span>,<br><span class="hljs-number">0x51</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0xD2</span>,<br><span class="hljs-number">0xCD</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x73</span>,<br><span class="hljs-number">0x60</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xDB</span>,<br><span class="hljs-number">0xE0</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x79</span>,<br><span class="hljs-number">0xE7</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x08</span>,<br><span class="hljs-number">0xBA</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x8A</span>,<br><span class="hljs-number">0x70</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x9E</span>,<br><span class="hljs-number">0xE1</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xDF</span>,<br><span class="hljs-number">0x8C</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x16</span>&#125;;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> inv_S[<span class="hljs-number">256</span>] = &#123;<br><span class="hljs-number">0x52</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xFB</span>,<br><span class="hljs-number">0x7C</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xCB</span>,<br><span class="hljs-number">0x54</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x4E</span>,<br><span class="hljs-number">0x08</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x25</span>,<br><span class="hljs-number">0x72</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x92</span>,<br><span class="hljs-number">0x6C</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x84</span>,<br><span class="hljs-number">0x90</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x06</span>,<br><span class="hljs-number">0xD0</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0x6B</span>,<br><span class="hljs-number">0x3A</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x73</span>,<br><span class="hljs-number">0x96</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0x6E</span>,<br><span class="hljs-number">0x47</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x1B</span>,<br><span class="hljs-number">0xFC</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xF4</span>,<br><span class="hljs-number">0x1F</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x5F</span>,<br><span class="hljs-number">0x60</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xEF</span>,<br><span class="hljs-number">0xA0</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x61</span>,<br><span class="hljs-number">0x17</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x7D</span>&#125;;<br></code></pre></td></tr></table></figure>

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690009427677-c6d93718-7ebe-4d87-80b5-a72a179a5c1c.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>特征值<strong>：&gt;&gt;4  &amp;0xF</strong></p>
<h3 id="行位移"><a href="#行位移" class="headerlink" title="行位移"></a>行位移</h3><p>只在4×4矩阵的行间进行操作，每行4字节的数据。在加密时，保持矩阵的第一行不变，第二行向左移一个字节、第三行向左移2个字节、第四行向左移3个字节</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690009530480-a3c0925f-502d-46a2-8703-74027c4f7452.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690009546418-117deded-2f60-4ed6-bdae-58ead405dd1a.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p><strong>特征值：三个&gt;&gt;和&lt;&lt;</strong></p>
<p>也可以这样，这个真有点抽象</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706086418277-4c776b78-c130-4fb2-8dcd-8136bea929be.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721699971674-0a74c06c-3b18-4598-99d6-184e37ea5562.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="列混淆"><a href="#列混淆" class="headerlink" title="列混淆"></a>列混淆</h3><p>在加密的正向列混淆中，我们要将输入的4·4矩阵左乘一个给定的4·4矩阵。而它们之间的加法、乘法都在扩展域GF(2^8)中进行，所以也就可以将这一个步骤分成两个部分进行讲解</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">const</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> MixArray[<span class="hljs-number">4</span>][<span class="hljs-number">4</span>] =<br>&#123;<br>    <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x01</span>,<br>    <span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x01</span>,<br>    <span class="hljs-number">0x01</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>,<br>    <span class="hljs-number">0x03</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span><br>    &#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">MixColum</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>(*PlainArray)[<span class="hljs-number">4</span>])</span><br>&#123;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> ArrayTemp[<span class="hljs-number">4</span>][<span class="hljs-number">4</span>];<br><br>    <span class="hljs-built_in">memcpy</span>(ArrayTemp, PlainArray, <span class="hljs-number">16</span>);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>    &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)<br>        &#123;<br>            PlainArray[i][j] =<br>            MixArray[i][<span class="hljs-number">0</span>] * ArrayTemp[<span class="hljs-number">0</span>][j] +<br>            MixArray[i][<span class="hljs-number">1</span>] * ArrayTemp[<span class="hljs-number">1</span>][j] +<br>            MixArray[i][<span class="hljs-number">2</span>] * ArrayTemp[<span class="hljs-number">2</span>][j] +<br>            MixArray[i][<span class="hljs-number">3</span>] * ArrayTemp[<span class="hljs-number">3</span>][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br></code></pre></td></tr></table></figure>

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721700131232-474c042d-74f2-457d-912f-e311fecaab9c.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="轮密钥加"><a href="#轮密钥加" class="headerlink" title="轮密钥加"></a>轮密钥加</h3><p>在密钥加法层中有两个输入的参数，分别是明文和子密钥k，而且这两个输入都是128位的。在%2的扩展域中加减法与异或运算等价，所以这里只需异或</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690009117330-39bdc891-aba1-4e93-a5e1-9a3187705a95.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="密钥生成"><a href="#密钥生成" class="headerlink" title="密钥生成"></a>密钥生成</h3><p>子密钥的生成是以列为单位进行的，一列是32Bit，四列组成子密钥共128Bit。生成子密钥的数量比AES算法的轮数多一个，因为第一个密钥加法层进行密钥漂白时也需要子密钥。密钥漂白是指在AES的输入盒输出中都使用的子密钥的XOR加法。子密钥在图中都存储在W[0]、W[1]…W[43]的扩展密钥数组之中</p>
<p>k1-k16表示原始密钥对应的字节，而图中子密钥k0与原始子密钥相同。在生成的扩展密钥中W的下标如果是4的倍数时(从零开始)需要对异或的参数进行G函数处理</p>
<p>扩展密钥生成有关公式如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">1</span>&lt;= i &lt;= <span class="hljs-number">10</span><br><span class="hljs-number">1</span>&lt;= j &lt;= <span class="hljs-number">3</span><br>W[<span class="hljs-number">4</span>i] = W[<span class="hljs-number">4</span>(i<span class="hljs-number">-1</span>)] ^ T(W[<span class="hljs-number">4</span>i<span class="hljs-number">-1</span>]);<br>W[<span class="hljs-number">4</span>i+j] = W[<span class="hljs-number">4</span>(i<span class="hljs-number">-1</span>)+j] ^ W[<span class="hljs-number">4</span>i<span class="hljs-number">-1</span>+j];<br></code></pre></td></tr></table></figure>

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690012128070-bb35c99c-29d8-4e75-ae4b-07e7b4245b96.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>T函数实现较复杂</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1711079059952-9a5a9730-8634-4b74-8dd1-b49bc974ceba.jpeg" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="填充"><a href="#填充" class="headerlink" title="填充"></a>填充</h2><p>几种典型的填充方式：</p>
<p><strong>NoPadding</strong>： 不做任何填充，但是要求明文必须是16字节的整数倍</p>
<p><strong>PKCS5Padding（默认）</strong>： 如果明文块少于16个字节，在明文块末尾补足相应数量的字符，且每个字节的值等于缺少的字符数。 比如明文：{1,2,3,4,5,a,b,c,d,e},缺少6个字节，则补全为{1,2,3,4,5,a,b,c,d,e,6,6,6,6,6,6 }</p>
<p><strong>ISO10126Padding</strong>：如果明文块少于16个字节（128bit），在明文块末尾补足相应数量的字节，最后一个字符值等于缺少的字符数，其他字符填充随机数。比如明文：{1,2,3,4,5,a,b,c,d,e},缺少6个字节，则可能补全为{1,2,3,4,5,a,b,c,d,e,5,c,3,G,$,6}</p>
<p>PKCS7Padding原理与PKCS5Padding相似，区别是PKCS5Padding的blocksize为8字节，而PKCS7Padding的blocksize可以为1到255字节</p>
<h2 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h2><p>AES的工作模式，体现在把明文块加密成密文块的处理过程中。AES加密算法提供了五种不同的工作模式：CBC,ECB,CTR,CFB,OFB</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690264717940-bec2a882-45fa-45c4-a1c4-23670f7b6ba1.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>适合加密随机数据</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1690264745779-c3d4ad6b-2983-4bd2-aef1-588027847abd.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>适合软件加密:CFB,OFB,CTR</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>标准aes</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><br>key = <span class="hljs-number">0x554B134A029DE539438BD18604BF114</span><br><br>key_bytes = key.to_bytes(<span class="hljs-number">16</span>, byteorder=<span class="hljs-string">&#x27;big&#x27;</span>)<br><span class="hljs-built_in">print</span>(key_bytes)<br><br>encrypted_data = <span class="hljs-string">&quot;2e8Ugcv8lKVhL3gkv3grJGNE3UqkjlvKqCgJSGRNHHEk98Kd0wv6s60GpAUsU+8Q&quot;</span><br><br>encrypted_bytes = base64.b64decode(encrypted_data)<br><br><br>cipher = AES.new(key_bytes, AES.MODE_ECB)<br><br><span class="hljs-keyword">try</span>:<br>    decrypted_data = unpad(cipher.decrypt(encrypted_bytes), AES.block_size)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密结果:&quot;</span>, decrypted_data.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><span class="hljs-keyword">except</span> (ValueError, KeyError):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密失败或填充错误！&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>这是修改s盒的代码，密文只能16位一组解密，密文按顺序提取unspaced即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IAES</span>:<br>    <span class="hljs-keyword">global</span> new_s_box<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.Nk = <span class="hljs-number">4</span><br>        self.Nb = <span class="hljs-number">4</span><br>        self.Nr = <span class="hljs-number">10</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">arrays</span>(<span class="hljs-params">self, raws</span>):<br>        Nb = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            Nb = Nb + [raws[<span class="hljs-number">4</span> * <span class="hljs-number">0</span> + i], raws[<span class="hljs-number">4</span> * <span class="hljs-number">1</span> + i], raws[<span class="hljs-number">4</span> * <span class="hljs-number">2</span> + i], raws[<span class="hljs-number">4</span> * <span class="hljs-number">3</span> + i]]<br>        <span class="hljs-keyword">return</span> Nb<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">Inv_arrays</span>(<span class="hljs-params">self, raws</span>):<br>        Inv_raws = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            Inv_raws = Inv_raws + [raws[<span class="hljs-number">4</span> * <span class="hljs-number">0</span> + i], raws[<span class="hljs-number">4</span> * <span class="hljs-number">1</span> + i], raws[<span class="hljs-number">4</span> * <span class="hljs-number">2</span> + i], raws[<span class="hljs-number">4</span> * <span class="hljs-number">3</span> + i]]<br>        <span class="hljs-keyword">return</span> Inv_raws<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">view</span>(<span class="hljs-params">self, raws</span>):<br>        raws = self.Inv_arrays(raws)<br>        raws = <span class="hljs-string">&#x27;&#x27;</span>.join([x.to_bytes(<span class="hljs-number">1</span>, byteorder=<span class="hljs-string">&#x27;big&#x27;</span>).<span class="hljs-built_in">hex</span>() <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> raws])<br>        <span class="hljs-built_in">print</span>(raws)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">view2</span>(<span class="hljs-params">self, <span class="hljs-built_in">list</span></span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(<span class="hljs-built_in">list</span>)):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">format</span>(<span class="hljs-built_in">list</span>[i], <span class="hljs-string">&#x27;2x&#x27;</span>), end=<span class="hljs-string">&#x27; &#x27;</span>)<br>            <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">3</span> == <span class="hljs-number">3</span>:  <span class="hljs-comment"># i%4 == 3</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n&#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n&#x27;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">AddRoundKey</span>(<span class="hljs-params">self, raws, Keys</span>):<br>        AddRoundKey = []<br>        <span class="hljs-keyword">for</span> raw, Key <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(raws, Keys):<br>            AddRoundKey.append(raw ^ Key)<br>        <span class="hljs-keyword">return</span> AddRoundKey<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">SubBytes</span>(<span class="hljs-params">self, raws</span>):<br>        S_box=new_s_box<br>        raws_S_box = []<br>        <span class="hljs-keyword">for</span> raw <span class="hljs-keyword">in</span> raws:<br>            raws_S_box.append(S_box[raw])<br>        <span class="hljs-keyword">return</span> raws_S_box<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">InvSubBytes</span>(<span class="hljs-params">self, raws,inv_s_box</span>):<br>        IS_box = inv_s_box<br>        raws_IS_box = []<br>        <span class="hljs-keyword">for</span> raw <span class="hljs-keyword">in</span> raws:<br>            raws_IS_box.append(IS_box[raw])<br>        <span class="hljs-keyword">return</span> raws_IS_box<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">InvShiftRows</span>(<span class="hljs-params">self, raws</span>):<br>        s13 = raws.pop(<span class="hljs-number">7</span>)<br>        raws.insert(<span class="hljs-number">4</span>, s13)<br>        s2223 = raws[<span class="hljs-number">10</span>:<span class="hljs-number">12</span>]<br>        <span class="hljs-keyword">del</span> raws[<span class="hljs-number">10</span>:<span class="hljs-number">12</span>]<br>        raws[<span class="hljs-number">8</span>:<span class="hljs-number">0</span>] = s2223<br>        s313233 = raws[<span class="hljs-number">13</span>:<span class="hljs-number">16</span>]<br>        <span class="hljs-keyword">del</span> raws[<span class="hljs-number">13</span>:<span class="hljs-number">16</span>]<br>        raws[<span class="hljs-number">12</span>:<span class="hljs-number">0</span>] = s313233<br>        <span class="hljs-keyword">return</span> raws<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">GMUL</span>(<span class="hljs-params">self, a, b</span>):  <span class="hljs-comment"># Russian Peasant Multiplication algorithm</span><br>        p = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> a <span class="hljs-keyword">and</span> b:<br>            <span class="hljs-keyword">if</span> b &amp; <span class="hljs-number">1</span>:  <span class="hljs-comment"># b%2</span><br>                p = p ^ a<br>            <span class="hljs-keyword">if</span> a &amp; <span class="hljs-number">0x80</span>:  <span class="hljs-comment"># a=a*x^7(a&gt;0),a &gt;= 2**7(128)</span><br>                a = (a &lt;&lt; <span class="hljs-number">1</span>) ^ <span class="hljs-number">0x11b</span>  <span class="hljs-comment"># 0x11b = x^8 + x^4 + x^3 + x + 1 (0b100011011)</span><br>            <span class="hljs-keyword">else</span>:<br>                a = a &lt;&lt; <span class="hljs-number">1</span><br>            b = b &gt;&gt; <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> p<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">InvMixColumns</span>(<span class="hljs-params">self, raws</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            raws[<span class="hljs-number">0</span> * <span class="hljs-number">4</span> + i], \<br>                raws[<span class="hljs-number">1</span> * <span class="hljs-number">4</span> + i], \<br>                raws[<span class="hljs-number">2</span> * <span class="hljs-number">4</span> + i], \<br>                raws[<span class="hljs-number">3</span> * <span class="hljs-number">4</span> + i] \<br>                = \<br>                self.GMUL(<span class="hljs-number">0x0e</span>, raws[<span class="hljs-number">0</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0b</span>, raws[<span class="hljs-number">1</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0d</span>, raws[<br>                    <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x09</span>, raws[<span class="hljs-number">3</span> * <span class="hljs-number">4</span> + i]), \<br>                self.GMUL(<span class="hljs-number">0x09</span>, raws[<span class="hljs-number">0</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0e</span>, raws[<span class="hljs-number">1</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0b</span>, raws[<br>                    <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0d</span>, raws[<span class="hljs-number">3</span> * <span class="hljs-number">4</span> + i]), \<br>                self.GMUL(<span class="hljs-number">0x0d</span>, raws[<span class="hljs-number">0</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x09</span>, raws[<span class="hljs-number">1</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0e</span>, raws[<br>                    <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0b</span>, raws[<span class="hljs-number">3</span> * <span class="hljs-number">4</span> + i]), \<br>                self.GMUL(<span class="hljs-number">0x0b</span>, raws[<span class="hljs-number">0</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0d</span>, raws[<span class="hljs-number">1</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x09</span>, raws[<br>                    <span class="hljs-number">2</span> * <span class="hljs-number">4</span> + i]) ^ self.GMUL(<span class="hljs-number">0x0e</span>, raws[<span class="hljs-number">3</span> * <span class="hljs-number">4</span> + i])<br>        <span class="hljs-keyword">return</span> raws<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">RotWord</span>(<span class="hljs-params">self, temp</span>):<br>        b0 = temp.pop(<span class="hljs-number">0</span>)<br>        temp.insert(<span class="hljs-number">3</span>, b0)<br>        <span class="hljs-keyword">return</span> temp<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">SubWord</span>(<span class="hljs-params">self, temp</span>):<br>        temp = self.SubBytes(temp)<br>        <span class="hljs-keyword">return</span> temp<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">KeyExpansion</span>(<span class="hljs-params">self, key</span>):<br>        i = <span class="hljs-number">0</span><br>        w = [[<span class="hljs-number">0</span>]] * (self.Nb * (self.Nr + <span class="hljs-number">1</span>))<br>        Rcon = [[<span class="hljs-number">0x01</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x02</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x04</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x08</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x10</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x20</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x40</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x80</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x1B</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>],<br>                [<span class="hljs-number">0x36</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>]<br>                ]<br>        <span class="hljs-keyword">while</span> i &lt; self.Nk:<br>            w[i] = ([key[<span class="hljs-number">4</span> * i], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">1</span>], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">3</span>]])<br>            i = i + <span class="hljs-number">1</span><br><br>        i = self.Nk<br><br>        <span class="hljs-keyword">while</span> i &lt; self.Nb * (self.Nr + <span class="hljs-number">1</span>):<br>            temp = w[i - <span class="hljs-number">1</span>].copy()<br>            <span class="hljs-keyword">if</span> i % self.Nk == <span class="hljs-number">0</span>:<br>                temp = self.SubWord(self.RotWord(temp))<br>                temp2 = []<br>                <span class="hljs-keyword">for</span> temp1, Rcon1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(temp, Rcon[(i // self.Nk) - <span class="hljs-number">1</span>]):<br>                    temp2.append(temp1 ^ Rcon1)<br>                temp = temp2<br>            <span class="hljs-keyword">elif</span> self.Nk &gt; <span class="hljs-number">6</span> <span class="hljs-keyword">and</span> i % self.Nk == <span class="hljs-number">4</span>:<br>                temp = self.SubWord(temp)<br>            w_temp = []<br>            <span class="hljs-keyword">for</span> w1, temp1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(w[i - self.Nk], temp):<br>                w_temp.append(w1 ^ temp1)<br>            w[i] = w_temp<br>            i = i + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> w<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">IAES</span>(<span class="hljs-params">self, IInput, Cipher_Key,inv_s_box</span>):<br>        IInput = [IInput1 <span class="hljs-keyword">for</span> IInput1 <span class="hljs-keyword">in</span> IInput]<br>        Cipher_Key = [Cipher_Key1 <span class="hljs-keyword">for</span> Cipher_Key1 <span class="hljs-keyword">in</span> Cipher_Key]<br>        KeyExpansion = self.KeyExpansion(Cipher_Key)<br>        keys = []<br>        <span class="hljs-keyword">for</span> Key_index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(KeyExpansion) // <span class="hljs-number">4</span>):<br>            keys_temp = (KeyExpansion[<span class="hljs-number">4</span> * Key_index] + KeyExpansion[<span class="hljs-number">4</span> * Key_index + <span class="hljs-number">1</span>] + KeyExpansion[<br>                <span class="hljs-number">4</span> * Key_index + <span class="hljs-number">2</span>] + KeyExpansion[<span class="hljs-number">4</span> * Key_index + <span class="hljs-number">3</span>])<br>            keys_temp = self.arrays(keys_temp)<br>            keys.append(keys_temp)<br>        IInput = self.arrays(IInput)<br>        self.view(IInput)<br>        self.view(keys[-<span class="hljs-number">1</span>])<br>        IInput = self.AddRoundKey(IInput, keys[-<span class="hljs-number">1</span>])<br>        self.view(IInput)<br>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.Nr - <span class="hljs-number">1</span>):<br>            IInput = self.InvShiftRows(IInput)<br>            self.view(IInput)<br>            IInput = self.InvSubBytes(IInput,inv_s_box)<br>            self.view(IInput)<br>            self.view(keys[-<span class="hljs-number">1</span> - <span class="hljs-number">1</span> - index])<br>            IInput = self.AddRoundKey(IInput, keys[-<span class="hljs-number">1</span> - <span class="hljs-number">1</span> - index])<br>            self.view(IInput)<br>            IInput = self.InvMixColumns(IInput)<br>            self.view(IInput)<br>        IInput = self.InvShiftRows(IInput)<br>        self.view(IInput)<br>        IInput = self.InvSubBytes(IInput,inv_s_box)<br>        self.view(IInput)<br>        self.view(keys[<span class="hljs-number">0</span>])<br>        IInput = self.AddRoundKey(IInput, keys[<span class="hljs-number">0</span>])<br>        self.view(IInput)<br>        IInput = self.Inv_arrays(IInput)<br>        IInput = <span class="hljs-built_in">bytes</span>(IInput)<br>        <span class="hljs-keyword">return</span> IInput<br><br><br>S_box = [<br>    <span class="hljs-number">0x63</span>, <span class="hljs-number">0x7c</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x7b</span>, <span class="hljs-number">0xf2</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x6f</span>, <span class="hljs-number">0xc5</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x2b</span>, <span class="hljs-number">0xfe</span>, <span class="hljs-number">0xd7</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0x76</span>,<br>    <span class="hljs-number">0xca</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0xc9</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0xfa</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xf0</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0xd4</span>, <span class="hljs-number">0xa2</span>, <span class="hljs-number">0xaf</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0xa4</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0xc0</span>,<br>    <span class="hljs-number">0xb7</span>, <span class="hljs-number">0xfd</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0xcc</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xe5</span>, <span class="hljs-number">0xf1</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x15</span>,<br>    <span class="hljs-number">0x04</span>, <span class="hljs-number">0xc7</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xc3</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x9a</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xe2</span>, <span class="hljs-number">0xeb</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xb2</span>, <span class="hljs-number">0x75</span>,<br>    <span class="hljs-number">0x09</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x1a</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x6e</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0xa0</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x3b</span>, <span class="hljs-number">0xd6</span>, <span class="hljs-number">0xb3</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xe3</span>, <span class="hljs-number">0x2f</span>, <span class="hljs-number">0x84</span>,<br>    <span class="hljs-number">0x53</span>, <span class="hljs-number">0xd1</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xed</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xfc</span>, <span class="hljs-number">0xb1</span>, <span class="hljs-number">0x5b</span>, <span class="hljs-number">0x6a</span>, <span class="hljs-number">0xcb</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x4a</span>, <span class="hljs-number">0x4c</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xcf</span>,<br>    <span class="hljs-number">0xd0</span>, <span class="hljs-number">0xef</span>, <span class="hljs-number">0xaa</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x4d</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x7f</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x3c</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0xa8</span>,<br>    <span class="hljs-number">0x51</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x8f</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0xbc</span>, <span class="hljs-number">0xb6</span>, <span class="hljs-number">0xda</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xff</span>, <span class="hljs-number">0xf3</span>, <span class="hljs-number">0xd2</span>,<br>    <span class="hljs-number">0xcd</span>, <span class="hljs-number">0x0c</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xec</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xc4</span>, <span class="hljs-number">0xa7</span>, <span class="hljs-number">0x7e</span>, <span class="hljs-number">0x3d</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x73</span>,<br>    <span class="hljs-number">0x60</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x4f</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xee</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0x5e</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0xdb</span>,<br>    <span class="hljs-number">0xe0</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0x0a</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0xc2</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0xac</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xe4</span>, <span class="hljs-number">0x79</span>,<br>    <span class="hljs-number">0xe7</span>, <span class="hljs-number">0xc8</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x6d</span>, <span class="hljs-number">0x8d</span>, <span class="hljs-number">0xd5</span>, <span class="hljs-number">0x4e</span>, <span class="hljs-number">0xa9</span>, <span class="hljs-number">0x6c</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xf4</span>, <span class="hljs-number">0xea</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0x08</span>,<br>    <span class="hljs-number">0xba</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x2e</span>, <span class="hljs-number">0x1c</span>, <span class="hljs-number">0xa6</span>, <span class="hljs-number">0xb4</span>, <span class="hljs-number">0xc6</span>, <span class="hljs-number">0xe8</span>, <span class="hljs-number">0xdd</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x1f</span>, <span class="hljs-number">0x4b</span>, <span class="hljs-number">0xbd</span>, <span class="hljs-number">0x8b</span>, <span class="hljs-number">0x8a</span>,<br>    <span class="hljs-number">0x70</span>, <span class="hljs-number">0x3e</span>, <span class="hljs-number">0xb5</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xb9</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xc1</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x9e</span>,<br>    <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x8e</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x9b</span>, <span class="hljs-number">0x1e</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xe9</span>, <span class="hljs-number">0xce</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xdf</span>,<br>    <span class="hljs-number">0x8c</span>, <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x0d</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0xe6</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x2d</span>, <span class="hljs-number">0x0f</span>, <span class="hljs-number">0xb0</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0xbb</span>, <span class="hljs-number">0x16</span><br>]<br><br>new_s_box = [<span class="hljs-number">0x31</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xCB</span>,<br>             <span class="hljs-number">0x53</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x78</span>,<br>             <span class="hljs-number">0x6C</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x5B</span>,<br>             <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0xA5</span>,<br>             <span class="hljs-number">0xDA</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xC0</span>,<br>             <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x87</span>,<br>             <span class="hljs-number">0x94</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xCC</span>,<br>             <span class="hljs-number">0x86</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x90</span>,<br>             <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x64</span>,<br>             <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0xB6</span>,<br>             <span class="hljs-number">0x43</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xE5</span>,<br>             <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xF0</span>,<br>             <span class="hljs-number">0x32</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xA8</span>,<br>             <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x1C</span>,<br>             <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0xFD</span>]<br><br>new_contrary_sbox = [<span class="hljs-number">0</span>] * <span class="hljs-number">256</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    line = (new_s_box[i] &amp; <span class="hljs-number">0xf0</span>) &gt;&gt; <span class="hljs-number">4</span><br><br>    rol = new_s_box[i] &amp; <span class="hljs-number">0xf</span><br><br>    new_contrary_sbox[(line * <span class="hljs-number">16</span>) + rol] = i<br><br><span class="hljs-built_in">print</span>(new_contrary_sbox)<br>IInput = <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-string">&#x27;B0CC93EAE92FEF5699396E023B4F9E42&#x27;</span>)<br><span class="hljs-built_in">print</span>(IInput)<br>Cipher_Key = <span class="hljs-built_in">bytes</span>(<span class="hljs-string">b&#x27;user01_nkctf2024&#x27;</span>)<br><span class="hljs-built_in">print</span>(Cipher_Key)<br>Out = IAES().IAES(IInput, Cipher_Key,new_contrary_sbox)<br><span class="hljs-built_in">print</span>(Out)<br></code></pre></td></tr></table></figure>

<h1 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h1><p>对称密码，DES使用64位的密钥和64位的明文块进行加密。DES算法的分组大小是64位，因此，如果需要加密的明文长度不足64位，需要进行填充；如果明文长度超过64位，则需要使用分组模式进行分组加密</p>
<p><strong>识别主要靠常量</strong></p>
<h2 id="初始置换-IP置换"><a href="#初始置换-IP置换" class="headerlink" title="初始置换(IP置换)"></a>初始置换(IP置换)</h2><p>将输入的64位明文块进行置换和重新排列，生成新的64位数据块</p>
<p>目的:增加加密的混乱程度，使明文中的每一位都能够对后面的加密过程产生影响，提高加密强度</p>
<p>我们将把64位的顺序按下表中规定的顺序放置，图中的数字是在64位明文中每个比特的索引位置</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071400888-30529eea-1dbf-4aed-99b6-19d64f855758.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1727531578705-8594fe2a-08e7-46a4-a7b6-e356c9a8929c.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="加密轮次"><a href="#加密轮次" class="headerlink" title="加密轮次"></a>加密轮次</h2><p>初始置换完成后，明文被划分成了相同长度（32位）的左右两部分，记作L0,R0。接下来就会进行16个轮次的加密</p>
<p>从单独一个轮次来看，首先把目光聚焦在R0这里。右半部分R0会作为下一轮次的左半部分L1的输入。其次，R0会补位到48位和本轮次生成的48位K0输入到F轮函数中去。F函数的输出结果为32位，结果F(R0,K0)会和L0进行异或运算作为下一轮次右半部分R1的输入</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071541210-ea7a4a4d-ec16-4ba0-9181-4e2d4759b699.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>以此类推，重复16轮运算</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071672214-90ee84c9-fa8b-40b7-8f20-cfbbbfb680a5.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="拓展R到48位"><a href="#拓展R到48位" class="headerlink" title="拓展R到48位"></a>拓展R到48位</h3><p>将32位的R0右半部分进行扩展，得到一个48位的数据块。同样的，数据拓展也是根据一个固定的置换表。红框中就是我们要补位的数据</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071810598-38955c99-d8a5-4220-bf79-8d787629cae6.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>由此可见，扩展过程的每一位都是根据上述的置换表从输入的32位数据块中提取出来的。原始数据的第32位被补充到了新增列的第一个，第5位被补充到了第二个新增列的第一个，以此类推</p>
<h3 id="子密钥k的生成"><a href="#子密钥k的生成" class="headerlink" title="子密钥k的生成"></a>子密钥k的生成</h3><p>DES算法采用了每轮子密钥生成的方式来增加密钥的复杂性和安全性。每轮子密钥都是由主密钥（64位）通过密钥调度算法（Key Schedule Algorithm）生成的。DES算法的密钥调度算法可以将64位的主密钥分成16个子密钥，每个子密钥48位，用于每轮加密中与输入数据进行异或运算</p>
<p>通过子密钥生成的流程图来看下整个过程</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694071939493-34bc8cab-2bd7-499c-9561-b8d15aaeee79.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>主密钥，下面56位是已经删除以8为倍数的奇偶校验位</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694079312722-d977fff3-3ac0-4f72-bbbe-ed5fa934945b.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h3><p>当前轮次的子密钥Ki（在上面56位的基础上删除特定的8位，得到48位）与拓展的48位Ri进行异或运算。运算结果会作为接下来S盒替换的输入</p>
<h3 id="S盒替换"><a href="#S盒替换" class="headerlink" title="S盒替换"></a>S盒替换</h3><p>用于将上一轮异或运算的48位结果映射到32位输出中去</p>
<p>6位变4位，首尾两位作为行标，中间四位作为列标，去不同的S盒对应一个小于16的数，再转化为4位二进制数</p>
<h3 id="P盒代换"><a href="#P盒代换" class="headerlink" title="P盒代换"></a>P盒代换</h3><img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694072162715-e2efba05-73c8-471a-96b2-35f24616460c.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>P盒代换将S盒替换的32位输出作为输入，经过上述固定的代换表进行代换后即为最后F轮函数的结果</p>
<h2 id="逆置换"><a href="#逆置换" class="headerlink" title="逆置换"></a>逆置换</h2><img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694072214847-8f04ca31-871f-49b7-b019-c02f3d928acd.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694078794302-44b2c0af-77ce-4b5e-8ac4-ab7cbe969fde.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694078824080-db4d1e9d-a053-45a6-bab4-85da101f2769.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="3DES"><a href="#3DES" class="headerlink" title="3DES"></a>3DES</h2><p>3DES顾名思义，就i是使用DES加密3次，使用3个密钥进行加解密</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1694072338044-c6e05c74-0d2e-476d-8de2-d0bb36fe6169.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h1 id="SM4"><a href="#SM4" class="headerlink" title="SM4"></a>SM4</h1><p>常数<code>0xa3b1bac6, 0x56aa3350, 0x677d9197, 0xb27022dc</code></p>
<p>分组密码，分组长度128位，密钥长度128位，32轮迭代和一次反序变换，输入4字（16字节，换算方法是密码算法特有的）</p>
<p>分为密钥拓展和加&#x2F;解密两个模块，下图是 SM4 的加解密（左）和密钥拓展（右）的流程图</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1707701871151-2c6db9da-3ca6-4ad3-b3cc-538572671725.png" srcset="/img/loading.gif" lazyload class="" title="img">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SM4</span> &#123;<br>    <span class="hljs-type">int</span>[] key_r;<br><br>    <span class="hljs-comment">/* 初始化轮密钥 */</span><br>    SM4(<span class="hljs-type">byte</span>[] key) &#123;<br>        <span class="hljs-built_in">this</span>.key_r = keyGenerate(key);<br>    &#125;<br><br>    <span class="hljs-comment">/* 密钥拓展 */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] keyGenerate(<span class="hljs-type">byte</span>[] key) &#123;<br>        <span class="hljs-type">int</span>[] key_r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">32</span>];<span class="hljs-comment">//轮密钥rk_i</span><br>        <span class="hljs-type">int</span>[] key_temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];<br>        <span class="hljs-type">int</span> box_in, box_out;<span class="hljs-comment">//盒变换输入输出</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] FK = &#123;<span class="hljs-number">0xa3b1bac6</span>, <span class="hljs-number">0x56aa3350</span>, <span class="hljs-number">0x677d9197</span>, <span class="hljs-number">0xb27022dc</span>&#125;;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] CK = &#123;<br>                <span class="hljs-number">0x00070e15</span>, <span class="hljs-number">0x1c232a31</span>, <span class="hljs-number">0x383f464d</span>, <span class="hljs-number">0x545b6269</span>,<br>                <span class="hljs-number">0x70777e85</span>, <span class="hljs-number">0x8c939aa1</span>, <span class="hljs-number">0xa8afb6bd</span>, <span class="hljs-number">0xc4cbd2d9</span>,<br>                <span class="hljs-number">0xe0e7eef5</span>, <span class="hljs-number">0xfc030a11</span>, <span class="hljs-number">0x181f262d</span>, <span class="hljs-number">0x343b4249</span>,<br>                <span class="hljs-number">0x50575e65</span>, <span class="hljs-number">0x6c737a81</span>, <span class="hljs-number">0x888f969d</span>, <span class="hljs-number">0xa4abb2b9</span>,<br>                <span class="hljs-number">0xc0c7ced5</span>, <span class="hljs-number">0xdce3eaf1</span>, <span class="hljs-number">0xf8ff060d</span>, <span class="hljs-number">0x141b2229</span>,<br>                <span class="hljs-number">0x30373e45</span>, <span class="hljs-number">0x4c535a61</span>, <span class="hljs-number">0x686f767d</span>, <span class="hljs-number">0x848b9299</span>,<br>                <span class="hljs-number">0xa0a7aeb5</span>, <span class="hljs-number">0xbcc3cad1</span>, <span class="hljs-number">0xd8dfe6ed</span>, <span class="hljs-number">0xf4fb0209</span>,<br>                <span class="hljs-number">0x10171e25</span>, <span class="hljs-number">0x2c333a41</span>, <span class="hljs-number">0x484f565d</span>, <span class="hljs-number">0x646b7279</span><br>        &#125;;<br>        <span class="hljs-comment">//将输入的密钥每32比特合并，并异或FK</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>            key_temp[i] = jointBytes(key[<span class="hljs-number">4</span> * i], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">1</span>], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>], key[<span class="hljs-number">4</span> * i + <span class="hljs-number">3</span>]);<br>            key_temp[i] = key_temp[i] ^ FK[i];<br>        &#125;<br>        <span class="hljs-comment">//32轮密钥拓展</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>            box_in = key_temp[<span class="hljs-number">1</span>] ^ key_temp[<span class="hljs-number">2</span>] ^ key_temp[<span class="hljs-number">3</span>] ^ CK[i];<br>            box_out = sBox(box_in);<br>            key_r[i] = key_temp[<span class="hljs-number">0</span>] ^ box_out ^ shift(box_out, <span class="hljs-number">13</span>) ^ shift(box_out, <span class="hljs-number">23</span>);<br>            key_temp[<span class="hljs-number">0</span>] = key_temp[<span class="hljs-number">1</span>];<br>            key_temp[<span class="hljs-number">1</span>] = key_temp[<span class="hljs-number">2</span>];<br>            key_temp[<span class="hljs-number">2</span>] = key_temp[<span class="hljs-number">3</span>];<br>            key_temp[<span class="hljs-number">3</span>] = key_r[i];<br>        &#125;<br>        <span class="hljs-keyword">return</span> key_r;<br>    &#125;<br><br>    <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] sm4Main(<span class="hljs-type">byte</span>[] input, <span class="hljs-type">int</span>[] key_r, <span class="hljs-type">int</span> mod) &#123;<br>        <span class="hljs-type">int</span>[] text = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];<span class="hljs-comment">//32比特字</span><br>        <span class="hljs-comment">//将输入以32比特分组</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>            text[i] = jointBytes(input[<span class="hljs-number">4</span> * i], input[<span class="hljs-number">4</span> * i + <span class="hljs-number">1</span>], input[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>], input[<span class="hljs-number">4</span> * i + <span class="hljs-number">3</span>]);<br>        &#125;<br>        <span class="hljs-type">int</span> box_input, box_output;<span class="hljs-comment">//盒变换输入和输出</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> (mod == <span class="hljs-number">0</span>) ? i : (<span class="hljs-number">31</span> - i);<span class="hljs-comment">//通过改变key_r的顺序改变模式</span><br>            box_input = text[<span class="hljs-number">1</span>] ^ text[<span class="hljs-number">2</span>] ^ text[<span class="hljs-number">3</span>] ^ key_r[index];<br>            box_output = sBox(box_input);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> text[<span class="hljs-number">0</span>] ^ box_output ^ shift(box_output, <span class="hljs-number">2</span>) ^ shift(box_output, <span class="hljs-number">10</span>) ^ shift(box_output, <span class="hljs-number">18</span>) ^ shift(box_output, <span class="hljs-number">24</span>);<br>            text[<span class="hljs-number">0</span>] = text[<span class="hljs-number">1</span>];<br>            text[<span class="hljs-number">1</span>] = text[<span class="hljs-number">2</span>];<br>            text[<span class="hljs-number">2</span>] = text[<span class="hljs-number">3</span>];<br>            text[<span class="hljs-number">3</span>] = temp;<br>        &#125;<br>        <span class="hljs-type">byte</span>[] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">16</span>];<br>        <span class="hljs-comment">//将结果的32比特字拆分</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>            System.arraycopy(splitInt(text[<span class="hljs-number">3</span> - i]), <span class="hljs-number">0</span>, output, <span class="hljs-number">4</span> * i, <span class="hljs-number">4</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> output;<br>    &#125;<br><br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] encrypt(<span class="hljs-type">byte</span>[] plaintext) &#123;<br>        <span class="hljs-keyword">return</span> sm4Main(plaintext, key_r, <span class="hljs-number">0</span>);<br>    &#125;<br><br>   <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] decrypt(<span class="hljs-type">byte</span>[] ciphertext) &#123;<br>        <span class="hljs-keyword">return</span> sm4Main(ciphertext, key_r, <span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/* 将32比特数拆分成4个8比特数 */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] splitInt(<span class="hljs-type">int</span> n) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;(<span class="hljs-type">byte</span>) (n &gt;&gt;&gt; <span class="hljs-number">24</span>), (<span class="hljs-type">byte</span>) (n &gt;&gt;&gt; <span class="hljs-number">16</span>), (<span class="hljs-type">byte</span>) (n &gt;&gt;&gt; <span class="hljs-number">8</span>), (<span class="hljs-type">byte</span>) n&#125;;<br>    &#125;<br><br>    <span class="hljs-comment">/* 将4个8比特数合并成32比特数 */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">jointBytes</span><span class="hljs-params">(<span class="hljs-type">byte</span> byte_0, <span class="hljs-type">byte</span> byte_1, <span class="hljs-type">byte</span> byte_2, <span class="hljs-type">byte</span> byte_3)</span> &#123;<br>        <span class="hljs-keyword">return</span> ((byte_0 &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">24</span>) | ((byte_1 &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">16</span>) | ((byte_2 &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">8</span>) | (byte_3 &amp; <span class="hljs-number">0xFF</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">/* S盒变换 */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sBox</span><span class="hljs-params">(<span class="hljs-type">int</span> box_input)</span> &#123;<br>        <br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] SBOX = &#123;<br>                <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x9A</span>,<br>                <span class="hljs-number">0x76</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xEF</span>,<br>                <span class="hljs-number">0x98</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x80</span>,<br>                <span class="hljs-number">0xDF</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x19</span>,<br>                <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x9D</span>,<br>                <span class="hljs-number">0x35</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x00</span>,<br>                <span class="hljs-number">0x46</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x40</span>,<br>                <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x55</span>,<br>                <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x23</span>,<br>                <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x6C</span>,<br>                <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x0A</span>,<br>                <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x4A</span>,<br>                <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x4D</span>,<br>                <span class="hljs-number">0x20</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x48</span><br>        &#125;;<br><br>        <span class="hljs-type">byte</span>[] temp = splitInt(box_input);<span class="hljs-comment">//拆分32比特数</span><br>        <span class="hljs-type">byte</span>[] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">4</span>];<span class="hljs-comment">//单个盒变换输出</span><br>        <span class="hljs-comment">//盒变换</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) &#123;<br>            output[i] = (<span class="hljs-type">byte</span>) SBOX[temp[i] &amp; <span class="hljs-number">0xFF</span>];<br>        &#125;<br>        <span class="hljs-comment">//将4个8位字节合并为一个字作为盒变换输出</span><br>        <span class="hljs-keyword">return</span> jointBytes(output[<span class="hljs-number">0</span>], output[<span class="hljs-number">1</span>], output[<span class="hljs-number">2</span>], output[<span class="hljs-number">3</span>]);<br>    &#125;<br><br>    <span class="hljs-comment">/* 将input左移n位 */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">shift</span><span class="hljs-params">(<span class="hljs-type">int</span> input, <span class="hljs-type">int</span> n)</span> &#123;<br>        <span class="hljs-keyword">return</span> (input &gt;&gt;&gt; (<span class="hljs-number">32</span> - n)) | (input &lt;&lt; n);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>加解密代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">from</span> gmssl <span class="hljs-keyword">import</span> sm4<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SM4</span>:<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.crypt_sm4 = sm4.CryptSM4()  <span class="hljs-comment"># 实例化</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">str_to_hexStr</span>(<span class="hljs-params">self , hex_str</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        字符串转hex</span><br><span class="hljs-string">        :param hex_str: 字符串</span><br><span class="hljs-string">        :return: hex</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        hex_data = hex_str.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        str_bin = binascii.unhexlify(hex_data)<br>        <span class="hljs-keyword">return</span> str_bin.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encryptSM4</span>(<span class="hljs-params">self , encrypt_key , value</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        国密sm4加密</span><br><span class="hljs-string">        :param encrypt_key: sm4加密key</span><br><span class="hljs-string">        :param value: 待加密的字符串</span><br><span class="hljs-string">        :return: sm4加密后的十六进制值</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        crypt_sm4 = self.crypt_sm4<br>        crypt_sm4.set_key(encrypt_key.encode() , sm4.SM4_ENCRYPT)  <span class="hljs-comment"># 设置密钥</span><br>        date_str = <span class="hljs-built_in">str</span>(value)<br>        encrypt_value = crypt_sm4.crypt_ecb(date_str.encode())  <span class="hljs-comment"># 开始加密。bytes类型</span><br>        <span class="hljs-keyword">return</span> encrypt_value.<span class="hljs-built_in">hex</span>()  <span class="hljs-comment"># 返回十六进制值</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decryptSM4</span>(<span class="hljs-params">self , decrypt_key , encrypt_value</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        国密sm4解密</span><br><span class="hljs-string">        :param decrypt_key:sm4加密key</span><br><span class="hljs-string">        :param encrypt_value: 待解密的十六进制值</span><br><span class="hljs-string">        :return: 原字符串</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        crypt_sm4 = self.crypt_sm4<br>        crypt_sm4.set_key(decrypt_key.encode() , sm4.SM4_DECRYPT)  <span class="hljs-comment"># 设置密钥</span><br>        decrypt_value = crypt_sm4.crypt_ecb(<span class="hljs-built_in">bytes</span>.fromhex(encrypt_value))  <span class="hljs-comment"># 开始解密。十六进制类型</span><br>        <span class="hljs-keyword">return</span> decrypt_value.decode()<br>        <span class="hljs-comment"># return self.str_to_hexStr(decrypt_value.hex())</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    key = <span class="hljs-string">&quot;C3AE5873D08418DA&quot;</span><br>    strData = <span class="hljs-string">&#x27;&#x27;&#x27;&#123;&quot;addr&quot;:&quot;&quot;,&quot;regnCode&quot;:&quot;320100&quot;,&quot;medinsName&quot;:&quot;&quot;,&quot;medinsLvCode&quot;:&quot;&quot;,&quot;medinsTypeCode&quot;:&quot;&quot;,&quot;openElec&quot;:&quot;&quot;,&quot;pageNum&quot;:6,&quot;pageSize&quot;:100&#125;&#x27;&#x27;&#x27;</span><br>    SM4 = SM4()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;原字符：&quot;</span> , strData)<br>    encData = SM4.encryptSM4(key , strData)  <span class="hljs-comment"># 加密后的数据，返回bytes类型</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;sm4加密结果：&quot;</span> , encData)<br><br>    decData = SM4.decryptSM4(key , encData)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;sm4解密结果：&quot;</span> , decData)  <span class="hljs-comment"># 解密后的数据</span><br></code></pre></td></tr></table></figure>

<h1 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h1><p>[<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115270932#:~:text=C%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%20%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%E6%A0%B9%E6%8D%AE%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E4%BF%AE%E6%94%B9%E3%80%81%E6%B3%A8%E9%87%8A%E8%80%8C%E6%9D%A5%EF%BC%8C%E6%AF%95%E7%AB%9FMD5%E7%AE%97%E6%B3%95%E4%B8%8D%E6%98%AF%E6%88%91%E5%8E%9F%E5%88%9B%E7%9A%84%E3%80%82%20%2F%2A,%E5%87%BD%E6%95%B0%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%EF%BC%9A%20%E5%85%88%E8%B0%83%E7%94%A8MD5Init%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AAMD5_CTX%E7%B1%BB%E5%9E%8B%E7%BB%93%E6%9E%84%E4%BD%93%EF%BC%8C%E5%86%8D%E4%BD%BF%E7%94%A8MD5Update%E8%AE%A1%E7%AE%97MD5%E7%A0%81%EF%BC%8C%E6%9C%80%E5%90%8E%E8%B0%83%E7%94%A8MD5Final%E8%8E%B7%E5%8F%96%20%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%E8%A7%81%E6%9C%80%E4%B8%8B%E9%9D%A2%E7%9A%84main%E5%87%BD%E6%95%B0%E3%80%82]">https://zhuanlan.zhihu.com/p/115270932#:~:text=C%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%20%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%E6%A0%B9%E6%8D%AE%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%E4%BF%AE%E6%94%B9%E3%80%81%E6%B3%A8%E9%87%8A%E8%80%8C%E6%9D%A5%EF%BC%8C%E6%AF%95%E7%AB%9FMD5%E7%AE%97%E6%B3%95%E4%B8%8D%E6%98%AF%E6%88%91%E5%8E%9F%E5%88%9B%E7%9A%84%E3%80%82%20%2F%2A,%E5%87%BD%E6%95%B0%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%EF%BC%9A%20%E5%85%88%E8%B0%83%E7%94%A8MD5Init%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AAMD5_CTX%E7%B1%BB%E5%9E%8B%E7%BB%93%E6%9E%84%E4%BD%93%EF%BC%8C%E5%86%8D%E4%BD%BF%E7%94%A8MD5Update%E8%AE%A1%E7%AE%97MD5%E7%A0%81%EF%BC%8C%E6%9C%80%E5%90%8E%E8%B0%83%E7%94%A8MD5Final%E8%8E%B7%E5%8F%96%20%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%E8%A7%81%E6%9C%80%E4%B8%8B%E9%9D%A2%E7%9A%84main%E5%87%BD%E6%95%B0%E3%80%82]</a>(<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115270932#:~:text=C%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0">https://zhuanlan.zhihu.com/p/115270932#:~:text=C语言实现</a> 以下代码根据参考文献修改、注释而来，毕竟MD5算法不是我原创的。 %2F*,函数使用说明： 先调用MD5Init初始化一个MD5_CTX类型结构体，再使用MD5Update计算MD5码，最后调用MD5Final获取 使用示例见最下面的main函数。)</p>
<p>MD5加密的函数大致如下：</p>
<p>MD5_CTX md5c;（结构体）</p>
<p>MD5Init(&amp;md5c);</p>
<p>MD5UpdateString(&amp;md5c,plain)</p>
<p>MD5Final(digest,&amp;md5c);</p>
<h2 id="数据填充"><a href="#数据填充" class="headerlink" title="数据填充"></a>数据填充</h2><p>MD5算法的第二步“分组循环变换”是以<strong>512</strong>位为一个分组进行处理的。因此，需要把数据填充成长度为512位的倍数。具体填充步骤如下：</p>
<p>1、先填充一个“1”，后面加上k个“0”。其中k是满足(n+1+k) mod 512 &#x3D; 448的最小正整数。</p>
<p>2、追加64位的数据长度（bit为单位，小端序存放）</p>
<p>填充完的数据大概长这样：</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970015957-e790cc21-69cd-4c27-82ec-04f5e2389777.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="分组循环变换"><a href="#分组循环变换" class="headerlink" title="分组循环变换"></a>分组循环变换</h2><p>其中，MD5Init会初始化四个称作MD5链接变量的整形参数。因此如果看到这4个常数<code>0x67452301、0xefcdab89、0x98badcfe、0x10325476</code>，就应该是MD5算法了。MD5Init函数代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">void MD5Init(MD5_CTX *context)  <br>&#123;  <br>     context-&gt;count[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;  <br>     context-&gt;count[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;  <br>     //Load magic initialization constants<br>     context-&gt;state[<span class="hljs-number">0</span>] = <span class="hljs-number">0x67452301</span>;  <br>     context-&gt;state[<span class="hljs-number">1</span>] = <span class="hljs-number">0xEFCDAB89</span>;  <br>     context-&gt;state[<span class="hljs-number">2</span>] = <span class="hljs-number">0x98BADCFE</span>;  <br>     context-&gt;state[<span class="hljs-number">3</span>] = <span class="hljs-number">0x10325476</span>;  <br>&#125;<br></code></pre></td></tr></table></figure>

<p>十进制表示如下，int最大是0x7fffffff，所以第2个和第3个为负数</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693966877726-70617850-e282-48d0-927a-83e303e32eb8.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>然后将填充完成后的数据划分成一个个512位的分组，依次进入循环变换。A、B、C、D也参与到循环变换中。数据分组进去变换的时候，大概走这么个流程：</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970069070-387aab7f-cd39-4461-8e4a-c67f1cab217c.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>循环变换是整个MD5算法最核心，也是最复杂的部分。一个512位分组的数据被进一步划分为16个32位的子分组，对每个子分组进行下图所示的变换：</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970143998-4b2596b3-2dcb-461a-a779-f18d47a34948.webp" srcset="/img/loading.gif" lazyload class="" title="img">

<p>上面只是画出了一个子分组进行的变换。下面对图中的元素进行说明：</p>
<p>1.图中的F函数代表一次由位运算构成的非线性变换，每一轮循环变换用到的F函数不一样</p>
<p>2.常数AC的值在每一次变换中都不一样</p>
<p>3.左移位数S有规律地周期性变化</p>
<p>数据的16个子分组都参与到上图所示的变换，顺序不定。当16个子分组处理完成时，我们就说完成了一轮循环变换。MD5的一个数据分组一共需要进行四轮的循环变换。将四轮循环变换后得到的A、B、C、D的值分别和原来的值相加，就是A、B、C、D进行循环变换后的结果</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970353116-2a024378-53db-4237-b495-6291b8c10b6d.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="拼接输出"><a href="#拼接输出" class="headerlink" title="拼接输出"></a>拼接输出</h2><p>将经过若干次循环变换后的A、B、C、D<strong>以十六进制的形式拼接起来</strong>，就是MD5码</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693970383717-bf407b4f-9917-4dbc-8818-8a0668643ea6.png" srcset="/img/loading.gif" lazyload class="" title="img">



<p>这里是加密函数，而且也能看到hash[]</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693465621018-8c8131a5-a32f-4e3b-9646-220b1bd2a96f.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>还有可能的特征</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1693465549899-24101ab3-d128-48be-9379-159436b0563b.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>完整代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment">函数使用说明：</span><br><span class="hljs-comment">先调用MD5Init初始化一个MD5_CTX类型结构体，再使用MD5Update计算MD5码，最后调用MD5Final获取</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *POINTER; <br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> state[<span class="hljs-number">4</span>];                                   <span class="hljs-comment">/* A,B,C,D四个常数 */</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count[<span class="hljs-number">2</span>];        <span class="hljs-comment">/* 数据的bit数计数器(对2^64取余) */</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> buffer[<span class="hljs-number">64</span>];                         <span class="hljs-comment">/* 输入数据缓冲区 */</span><br>&#125; MD5_CTX; <span class="hljs-comment">//存放MD5算法相关信息的结构体定义</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">MD5Init</span> <span class="hljs-params">(MD5_CTX *)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">MD5Update</span><span class="hljs-params">(MD5_CTX *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">MD5Final</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> [<span class="hljs-number">16</span>], MD5_CTX *)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">MD5Transform</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> [<span class="hljs-number">4</span>], <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> [<span class="hljs-number">64</span>])</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Encode</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Decode</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)</span>;<br><br><span class="hljs-comment">//循环左移的位数</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S11 7</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S12 12</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S13 17</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S14 22</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S21 5</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S22 9</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S23 14</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S24 20</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S31 4</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S32 11</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S33 16</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S34 23</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S41 6</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S42 10</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S43 15</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> S44 21</span><br><br><span class="hljs-comment">//数据填充的内容</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> PADDING[<span class="hljs-number">64</span>] = &#123;<br>    <span class="hljs-number">0x80</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<br>    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<br>    <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>    &#125;;<br><br><span class="hljs-comment">//F,G,H,I四个非线性变换函数</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> F(x, y, z) (((x) &amp; (y)) | ((~x) &amp; (z)))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> G(x, y, z) (((x) &amp; (z)) | ((y) &amp; (~z)))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> H(x, y, z) ((x) ^ (y) ^ (z))</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> I(x, y, z) ((y) ^ ((x) | (~z)))</span><br><br><span class="hljs-comment">//x循环左移n位的操作</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ROTATE_LEFT(x, n) (((x) <span class="hljs-string">&lt;&lt; (n)) | ((x) &gt;</span>&gt; (32-(n))))</span><br><br><span class="hljs-comment">//FF,GG,HH,II是四轮循环变换分别用到的变换函数</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> FF(a, b, c, d, x, s, ac) &#123; \</span><br><span class="hljs-meta"> (a) += F ((b), (c), (d)) + (x) + (unsigned int)(ac); \</span><br><span class="hljs-meta"> (a) = ROTATE_LEFT ((a), (s)); \</span><br><span class="hljs-meta"> (a) += (b); \</span><br><span class="hljs-meta">  &#125;</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> GG(a, b, c, d, x, s, ac) &#123; \</span><br><span class="hljs-meta"> (a) += G ((b), (c), (d)) + (x) + (unsigned int)(ac); \</span><br><span class="hljs-meta"> (a) = ROTATE_LEFT ((a), (s)); \</span><br><span class="hljs-meta"> (a) += (b); \</span><br><span class="hljs-meta">  &#125;</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> HH(a, b, c, d, x, s, ac) &#123; \</span><br><span class="hljs-meta"> (a) += H ((b), (c), (d)) + (x) + (unsigned int)(ac); \</span><br><span class="hljs-meta"> (a) = ROTATE_LEFT ((a), (s)); \</span><br><span class="hljs-meta"> (a) += (b); \</span><br><span class="hljs-meta">  &#125;</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> II(a, b, c, d, x, s, ac) &#123; \</span><br><span class="hljs-meta"> (a) += I ((b), (c), (d)) + (x) + (unsigned int)(ac); \</span><br><span class="hljs-meta"> (a) = ROTATE_LEFT ((a), (s)); \</span><br><span class="hljs-meta"> (a) += (b); \</span><br><span class="hljs-meta">  &#125;</span><br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">MD5Init</span> <span class="hljs-params">(MD5_CTX *context)</span><br>&#123;<br>    <span class="hljs-comment">//bit计数器清零</span><br>    context-&gt;count[<span class="hljs-number">0</span>] = context-&gt;count[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//A,B,C,D被初始化为四个特定的常数(Magic Number)</span><br>    context-&gt;state[<span class="hljs-number">0</span>] = <span class="hljs-number">0x67452301</span>;<br>    context-&gt;state[<span class="hljs-number">1</span>] = <span class="hljs-number">0xefcdab89</span>;<br>    context-&gt;state[<span class="hljs-number">2</span>] = <span class="hljs-number">0x98badcfe</span>;<br>    context-&gt;state[<span class="hljs-number">3</span>] = <span class="hljs-number">0x10325476</span>;<br>&#125;<br><br><span class="hljs-comment">//使用MD5算法对input的数据进行处理</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">MD5Update</span> <span class="hljs-params">(MD5_CTX *context, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> inputLen)</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i, index, partLen;<br>    <span class="hljs-comment">//计算[已处理数据长度(byte) mod 64]</span><br>    index = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)((context-&gt;count[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0x3F</span>);<br>    <span class="hljs-comment">//bit计数器累加</span><br>    <span class="hljs-keyword">if</span> ((context-&gt;count[<span class="hljs-number">0</span>] += ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)inputLen &lt;&lt; <span class="hljs-number">3</span>))<br>      &lt; ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)inputLen &lt;&lt; <span class="hljs-number">3</span>)) <span class="hljs-comment">//处理加法进位溢出的情况</span><br>        context-&gt;count[<span class="hljs-number">1</span>]++;<br>    context-&gt;count[<span class="hljs-number">1</span>] += ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)inputLen &gt;&gt; <span class="hljs-number">29</span>);<br>    <span class="hljs-comment">//计算缓冲区还有多少字节空间</span><br>    partLen = <span class="hljs-number">64</span> - index;<br>    <span class="hljs-comment">//以512位数据为一组进行处理</span><br>    <span class="hljs-keyword">if</span> (inputLen &gt;= partLen) &#123;<br>        <span class="hljs-built_in">memcpy</span>(&amp;context-&gt;buffer[index],input, partLen);<br>        MD5Transform (context-&gt;state, context-&gt;buffer);<br>        <span class="hljs-keyword">for</span> (i = partLen; i + <span class="hljs-number">63</span> &lt; inputLen; i += <span class="hljs-number">64</span>)<br>            MD5Transform (context-&gt;state, &amp;input[i]);<br>        index = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//缓存未处理的输入</span><br>    <span class="hljs-built_in">memcpy</span>(&amp;context-&gt;buffer[index],&amp;input[i],inputLen-i);<br>&#125;<br><br><span class="hljs-comment">//获取MD5码（由digest返回），顺便清除context数据</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">MD5Final</span> <span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> digest[<span class="hljs-number">16</span>], MD5_CTX *context)</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> bits[<span class="hljs-number">8</span>];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> index, padLen;<br>    <span class="hljs-comment">//记录数据长度</span><br>    Encode (bits, context-&gt;count, <span class="hljs-number">8</span>);<br>    <span class="hljs-comment">//填充数据</span><br>    index = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)((context-&gt;count[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">3</span>) &amp; <span class="hljs-number">0x3f</span>);<br>    padLen = (index &lt; <span class="hljs-number">56</span>) ? (<span class="hljs-number">56</span> - index) : (<span class="hljs-number">120</span> - index);<br>    MD5Update (context, PADDING, padLen);<br>    <span class="hljs-comment">//追加数据长度信息</span><br>    MD5Update (context, bits, <span class="hljs-number">8</span>);<br>    <span class="hljs-comment">//获取MD5码。其实就是将ABCD四个32位整数以16进制方式级联</span><br>    Encode (digest, context-&gt;state, <span class="hljs-number">16</span>);<br>    <span class="hljs-comment">//清除数据</span><br>    <span class="hljs-built_in">memset</span>(context, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(*context));<br>&#125;<br><br><span class="hljs-comment">//MD5变换函数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">MD5Transform</span> <span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> state[<span class="hljs-number">4</span>], <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> block[<span class="hljs-number">64</span>])</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a = state[<span class="hljs-number">0</span>], b = state[<span class="hljs-number">1</span>], c = state[<span class="hljs-number">2</span>], d = state[<span class="hljs-number">3</span>], x[<span class="hljs-number">16</span>];<br>    <span class="hljs-comment">//将64字节的一组数据进一步划分为16个子分组</span><br>    Decode (x, block, <span class="hljs-number">64</span>);<br>    <span class="hljs-comment">//第1轮循环变换</span><br>    FF (a, b, c, d, x[ <span class="hljs-number">0</span>], S11, <span class="hljs-number">0xd76aa478</span>); <span class="hljs-comment">/* 1 */</span><br>    FF (d, a, b, c, x[ <span class="hljs-number">1</span>], S12, <span class="hljs-number">0xe8c7b756</span>); <span class="hljs-comment">/* 2 */</span><br>    FF (c, d, a, b, x[ <span class="hljs-number">2</span>], S13, <span class="hljs-number">0x242070db</span>); <span class="hljs-comment">/* 3 */</span><br>    FF (b, c, d, a, x[ <span class="hljs-number">3</span>], S14, <span class="hljs-number">0xc1bdceee</span>); <span class="hljs-comment">/* 4 */</span><br>    FF (a, b, c, d, x[ <span class="hljs-number">4</span>], S11, <span class="hljs-number">0xf57c0faf</span>); <span class="hljs-comment">/* 5 */</span><br>    FF (d, a, b, c, x[ <span class="hljs-number">5</span>], S12, <span class="hljs-number">0x4787c62a</span>); <span class="hljs-comment">/* 6 */</span><br>    FF (c, d, a, b, x[ <span class="hljs-number">6</span>], S13, <span class="hljs-number">0xa8304613</span>); <span class="hljs-comment">/* 7 */</span><br>    FF (b, c, d, a, x[ <span class="hljs-number">7</span>], S14, <span class="hljs-number">0xfd469501</span>); <span class="hljs-comment">/* 8 */</span><br>    FF (a, b, c, d, x[ <span class="hljs-number">8</span>], S11, <span class="hljs-number">0x698098d8</span>); <span class="hljs-comment">/* 9 */</span><br>    FF (d, a, b, c, x[ <span class="hljs-number">9</span>], S12, <span class="hljs-number">0x8b44f7af</span>); <span class="hljs-comment">/* 10 */</span><br>    FF (c, d, a, b, x[<span class="hljs-number">10</span>], S13, <span class="hljs-number">0xffff5bb1</span>); <span class="hljs-comment">/* 11 */</span><br>    FF (b, c, d, a, x[<span class="hljs-number">11</span>], S14, <span class="hljs-number">0x895cd7be</span>); <span class="hljs-comment">/* 12 */</span><br>    FF (a, b, c, d, x[<span class="hljs-number">12</span>], S11, <span class="hljs-number">0x6b901122</span>); <span class="hljs-comment">/* 13 */</span><br>    FF (d, a, b, c, x[<span class="hljs-number">13</span>], S12, <span class="hljs-number">0xfd987193</span>); <span class="hljs-comment">/* 14 */</span><br>    FF (c, d, a, b, x[<span class="hljs-number">14</span>], S13, <span class="hljs-number">0xa679438e</span>); <span class="hljs-comment">/* 15 */</span><br>    FF (b, c, d, a, x[<span class="hljs-number">15</span>], S14, <span class="hljs-number">0x49b40821</span>); <span class="hljs-comment">/* 16 */</span><br>    <span class="hljs-comment">//第2轮循环变换</span><br>    GG (a, b, c, d, x[ <span class="hljs-number">1</span>], S21, <span class="hljs-number">0xf61e2562</span>); <span class="hljs-comment">/* 17 */</span><br>    GG (d, a, b, c, x[ <span class="hljs-number">6</span>], S22, <span class="hljs-number">0xc040b340</span>); <span class="hljs-comment">/* 18 */</span><br>    GG (c, d, a, b, x[<span class="hljs-number">11</span>], S23, <span class="hljs-number">0x265e5a51</span>); <span class="hljs-comment">/* 19 */</span><br>    GG (b, c, d, a, x[ <span class="hljs-number">0</span>], S24, <span class="hljs-number">0xe9b6c7aa</span>); <span class="hljs-comment">/* 20 */</span><br>    GG (a, b, c, d, x[ <span class="hljs-number">5</span>], S21, <span class="hljs-number">0xd62f105d</span>); <span class="hljs-comment">/* 21 */</span><br>    GG (d, a, b, c, x[<span class="hljs-number">10</span>], S22,  <span class="hljs-number">0x2441453</span>); <span class="hljs-comment">/* 22 */</span><br>    GG (c, d, a, b, x[<span class="hljs-number">15</span>], S23, <span class="hljs-number">0xd8a1e681</span>); <span class="hljs-comment">/* 23 */</span><br>    GG (b, c, d, a, x[ <span class="hljs-number">4</span>], S24, <span class="hljs-number">0xe7d3fbc8</span>); <span class="hljs-comment">/* 24 */</span><br>    GG (a, b, c, d, x[ <span class="hljs-number">9</span>], S21, <span class="hljs-number">0x21e1cde6</span>); <span class="hljs-comment">/* 25 */</span><br>    GG (d, a, b, c, x[<span class="hljs-number">14</span>], S22, <span class="hljs-number">0xc33707d6</span>); <span class="hljs-comment">/* 26 */</span><br>    GG (c, d, a, b, x[ <span class="hljs-number">3</span>], S23, <span class="hljs-number">0xf4d50d87</span>); <span class="hljs-comment">/* 27 */</span><br>    GG (b, c, d, a, x[ <span class="hljs-number">8</span>], S24, <span class="hljs-number">0x455a14ed</span>); <span class="hljs-comment">/* 28 */</span><br>    GG (a, b, c, d, x[<span class="hljs-number">13</span>], S21, <span class="hljs-number">0xa9e3e905</span>); <span class="hljs-comment">/* 29 */</span><br>    GG (d, a, b, c, x[ <span class="hljs-number">2</span>], S22, <span class="hljs-number">0xfcefa3f8</span>); <span class="hljs-comment">/* 30 */</span><br>    GG (c, d, a, b, x[ <span class="hljs-number">7</span>], S23, <span class="hljs-number">0x676f02d9</span>); <span class="hljs-comment">/* 31 */</span><br>    GG (b, c, d, a, x[<span class="hljs-number">12</span>], S24, <span class="hljs-number">0x8d2a4c8a</span>); <span class="hljs-comment">/* 32 */</span><br>    <span class="hljs-comment">//第3轮循环变换</span><br>    HH (a, b, c, d, x[ <span class="hljs-number">5</span>], S31, <span class="hljs-number">0xfffa3942</span>); <span class="hljs-comment">/* 33 */</span><br>    HH (d, a, b, c, x[ <span class="hljs-number">8</span>], S32, <span class="hljs-number">0x8771f681</span>); <span class="hljs-comment">/* 34 */</span><br>    HH (c, d, a, b, x[<span class="hljs-number">11</span>], S33, <span class="hljs-number">0x6d9d6122</span>); <span class="hljs-comment">/* 35 */</span><br>    HH (b, c, d, a, x[<span class="hljs-number">14</span>], S34, <span class="hljs-number">0xfde5380c</span>); <span class="hljs-comment">/* 36 */</span><br>    HH (a, b, c, d, x[ <span class="hljs-number">1</span>], S31, <span class="hljs-number">0xa4beea44</span>); <span class="hljs-comment">/* 37 */</span><br>    HH (d, a, b, c, x[ <span class="hljs-number">4</span>], S32, <span class="hljs-number">0x4bdecfa9</span>); <span class="hljs-comment">/* 38 */</span><br>    HH (c, d, a, b, x[ <span class="hljs-number">7</span>], S33, <span class="hljs-number">0xf6bb4b60</span>); <span class="hljs-comment">/* 39 */</span><br>    HH (b, c, d, a, x[<span class="hljs-number">10</span>], S34, <span class="hljs-number">0xbebfbc70</span>); <span class="hljs-comment">/* 40 */</span><br>    HH (a, b, c, d, x[<span class="hljs-number">13</span>], S31, <span class="hljs-number">0x289b7ec6</span>); <span class="hljs-comment">/* 41 */</span><br>    HH (d, a, b, c, x[ <span class="hljs-number">0</span>], S32, <span class="hljs-number">0xeaa127fa</span>); <span class="hljs-comment">/* 42 */</span><br>    HH (c, d, a, b, x[ <span class="hljs-number">3</span>], S33, <span class="hljs-number">0xd4ef3085</span>); <span class="hljs-comment">/* 43 */</span><br>    HH (b, c, d, a, x[ <span class="hljs-number">6</span>], S34,  <span class="hljs-number">0x4881d05</span>); <span class="hljs-comment">/* 44 */</span><br>    HH (a, b, c, d, x[ <span class="hljs-number">9</span>], S31, <span class="hljs-number">0xd9d4d039</span>); <span class="hljs-comment">/* 45 */</span><br>    HH (d, a, b, c, x[<span class="hljs-number">12</span>], S32, <span class="hljs-number">0xe6db99e5</span>); <span class="hljs-comment">/* 46 */</span><br>    HH (c, d, a, b, x[<span class="hljs-number">15</span>], S33, <span class="hljs-number">0x1fa27cf8</span>); <span class="hljs-comment">/* 47 */</span><br>    HH (b, c, d, a, x[ <span class="hljs-number">2</span>], S34, <span class="hljs-number">0xc4ac5665</span>); <span class="hljs-comment">/* 48 */</span><br>    <span class="hljs-comment">//第4轮循环变换</span><br>    II (a, b, c, d, x[ <span class="hljs-number">0</span>], S41, <span class="hljs-number">0xf4292244</span>); <span class="hljs-comment">/* 49 */</span><br>    II (d, a, b, c, x[ <span class="hljs-number">7</span>], S42, <span class="hljs-number">0x432aff97</span>); <span class="hljs-comment">/* 50 */</span><br>    II (c, d, a, b, x[<span class="hljs-number">14</span>], S43, <span class="hljs-number">0xab9423a7</span>); <span class="hljs-comment">/* 51 */</span><br>    II (b, c, d, a, x[ <span class="hljs-number">5</span>], S44, <span class="hljs-number">0xfc93a039</span>); <span class="hljs-comment">/* 52 */</span><br>    II (a, b, c, d, x[<span class="hljs-number">12</span>], S41, <span class="hljs-number">0x655b59c3</span>); <span class="hljs-comment">/* 53 */</span><br>    II (d, a, b, c, x[ <span class="hljs-number">3</span>], S42, <span class="hljs-number">0x8f0ccc92</span>); <span class="hljs-comment">/* 54 */</span><br>    II (c, d, a, b, x[<span class="hljs-number">10</span>], S43, <span class="hljs-number">0xffeff47d</span>); <span class="hljs-comment">/* 55 */</span><br>    II (b, c, d, a, x[ <span class="hljs-number">1</span>], S44, <span class="hljs-number">0x85845dd1</span>); <span class="hljs-comment">/* 56 */</span><br>    II (a, b, c, d, x[ <span class="hljs-number">8</span>], S41, <span class="hljs-number">0x6fa87e4f</span>); <span class="hljs-comment">/* 57 */</span><br>    II (d, a, b, c, x[<span class="hljs-number">15</span>], S42, <span class="hljs-number">0xfe2ce6e0</span>); <span class="hljs-comment">/* 58 */</span><br>    II (c, d, a, b, x[ <span class="hljs-number">6</span>], S43, <span class="hljs-number">0xa3014314</span>); <span class="hljs-comment">/* 59 */</span><br>    II (b, c, d, a, x[<span class="hljs-number">13</span>], S44, <span class="hljs-number">0x4e0811a1</span>); <span class="hljs-comment">/* 60 */</span><br>    II (a, b, c, d, x[ <span class="hljs-number">4</span>], S41, <span class="hljs-number">0xf7537e82</span>); <span class="hljs-comment">/* 61 */</span><br>    II (d, a, b, c, x[<span class="hljs-number">11</span>], S42, <span class="hljs-number">0xbd3af235</span>); <span class="hljs-comment">/* 62 */</span><br>    II (c, d, a, b, x[ <span class="hljs-number">2</span>], S43, <span class="hljs-number">0x2ad7d2bb</span>); <span class="hljs-comment">/* 63 */</span><br>    II (b, c, d, a, x[ <span class="hljs-number">9</span>], S44, <span class="hljs-number">0xeb86d391</span>); <span class="hljs-comment">/* 64 */</span><br><br>    state[<span class="hljs-number">0</span>] += a;<br>    state[<span class="hljs-number">1</span>] += b;<br>    state[<span class="hljs-number">2</span>] += c;<br>    state[<span class="hljs-number">3</span>] += d;<br>&#125;<br><br><span class="hljs-comment">//将无符号整数转为字节类型数组</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Encode</span> <span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *output, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *input,<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> len)</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i, j;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; j &lt; len; i++, j += <span class="hljs-number">4</span>) &#123;<br>        output[j] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)(input[i] &amp; <span class="hljs-number">0xff</span>);<br>        output[j+<span class="hljs-number">1</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)((input[i] &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>);<br>        output[j+<span class="hljs-number">2</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)((input[i] &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>);<br>        output[j+<span class="hljs-number">3</span>] = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>)((input[i] &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xff</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//将字节类型数组转为无符号整数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Decode</span> <span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *output, <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *input, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> len)</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i, j;<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>; j &lt; len; i++, j += <span class="hljs-number">4</span>)<br>        output[i] = ((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)input[j]) | (((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)input[j+<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span>) |<br>        (((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)input[j+<span class="hljs-number">2</span>]) &lt;&lt; <span class="hljs-number">16</span>) | (((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)input[j+<span class="hljs-number">3</span>]) &lt;&lt; <span class="hljs-number">24</span>);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    MD5_CTX md5_calc;<br>    <span class="hljs-type">char</span> c[]=<span class="hljs-string">&quot;abc&quot;</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> md5[<span class="hljs-number">16</span>];<br>    <span class="hljs-comment">//演示计算字符串abc的MD5码</span><br>    MD5Init(&amp;md5_calc);<br>    MD5Update(&amp;md5_calc,(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)c,<span class="hljs-built_in">strlen</span>(c));<br>    MD5Final(md5,&amp;md5_calc);<br>    <span class="hljs-comment">//输出MD5码</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;字符串abc的MD5码为：&quot;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">16</span>;i++) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%02x&quot;</span>,md5[i]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="BlowFish"><a href="#BlowFish" class="headerlink" title="BlowFish"></a><strong>BlowFish</strong></h1><p>是对称加密，是用来替代DES算法出现的，是 将一个数 拆分为 左右各32位然后 左边进行 ^ key_pbox 当作下一次循环的右边。右边 则是 右边 ^ F(左边)下次当作循环的左边</p>
<p>常量</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1703390912245-342578b0-719a-48dd-ab02-f0418c5681f1.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>常见的前几位PBox</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562401045-5cda2e71-7c6a-4a65-b23c-cc5109d80cc9.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="密钥扩展"><a href="#密钥扩展" class="headerlink" title="密钥扩展"></a>密钥扩展</h2><p><strong>循环轮数先是18，后是256</strong></p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562611018-1bd9f689-6e46-495d-8073-b22fa1ec241c.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562932304-1d1a2e44-0130-42e3-91f5-d3955ad66aaa.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562785506-05ec6741-6080-4994-b558-4e94c3ff83a7.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700562801014-54976159-044a-4f28-9e8d-97e10aad8bf9.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="数据加密"><a href="#数据加密" class="headerlink" title="数据加密"></a>数据加密</h2><img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700563149721-eaae8489-5f37-4634-8fab-96d0ac2e4308.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>16轮循环，里面有交换操作</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1700563125986-2126e3dd-4636-4c80-90ae-8e3f636ca6aa.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h1 id="sha1"><a href="#sha1" class="headerlink" title="sha1"></a>sha1</h1><p>主循环4轮，每轮20次操作 </p>
<p>有两组常量，分别对应k数组和MD buffer</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1707097836461-8a93cae5-dc75-44f6-8fe6-886db0e0db5b.png" srcset="/img/loading.gif" lazyload class="" title="img">



<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1714110661316-4c4b6b35-4fe4-40d9-95b9-2f7235ce7517.jpeg" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1714110671642-2aee3dba-bad9-4b34-bad4-6475cf53cd63.jpeg" srcset="/img/loading.gif" lazyload class="" title="img">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#include &lt;string.h&gt;</span><br><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br> <br><span class="hljs-comment">#define HASH_BLOCK_SIZE         64  /* 512 bits = 64 bytes */</span><br><span class="hljs-comment">#define HASH_LEN_SIZE           8   /* 64 bits =  8 bytes */</span><br><span class="hljs-comment">#define HASH_LEN_OFFSET         56  /* 64 bytes - 8 bytes */</span><br><span class="hljs-comment">#define HASH_DIGEST_SIZE        16  /* 128 bits = 16 bytes */</span><br><span class="hljs-comment">#define HASH_ROUND_NUM          80 </span><br> <br>typedef unsigned char       uint8_t;<br>typedef unsigned short <span class="hljs-built_in">int</span>  uint16_t;<br>typedef unsigned <span class="hljs-built_in">int</span>        uint32_t;<br>typedef unsigned long long  uint64_t;<br> <br>/* Swap <span class="hljs-built_in">bytes</span> <span class="hljs-keyword">in</span> <span class="hljs-number">32</span> bit value. <span class="hljs-number">0x01234567</span> -&gt; <span class="hljs-number">0x67452301</span> */<br><span class="hljs-comment">#define __bswap_32(x)    \</span><br>     ((((x) &amp; <span class="hljs-number">0xff000000</span>) &gt;&gt; <span class="hljs-number">24</span>)  \<br>     | (((x) &amp; <span class="hljs-number">0x00ff0000</span>) &gt;&gt;  <span class="hljs-number">8</span>) \<br>     | (((x) &amp; <span class="hljs-number">0x0000ff00</span>) &lt;&lt;  <span class="hljs-number">8</span>) \<br>     | (((x) &amp; <span class="hljs-number">0x000000ff</span>) &lt;&lt; <span class="hljs-number">24</span>))<br> <br>/* SHA1 Constants */<br>static uint32_t K[<span class="hljs-number">4</span>] =<br>&#123;<br>    <span class="hljs-number">0x5A827999</span>,     /* [<span class="hljs-number">0</span>,  <span class="hljs-number">19</span>] */<br>    <span class="hljs-number">0x6ED9EBA1</span>,     /* [<span class="hljs-number">20</span>, <span class="hljs-number">39</span>] */<br>    <span class="hljs-number">0x8F1BBCDC</span>,     /* [<span class="hljs-number">40</span>, <span class="hljs-number">59</span>] */<br>    <span class="hljs-number">0xCA62C1D6</span>      /* [<span class="hljs-number">60</span>, <span class="hljs-number">79</span>] */<br>&#125;;<br> <br>/*                  f(X, Y, Z)                      */<br>/* [<span class="hljs-number">0</span>,  <span class="hljs-number">19</span>] */<br>static uint32_t Ch(uint32_t X, uint32_t Y, uint32_t Z)<br>&#123;<br>    <span class="hljs-keyword">return</span> (X &amp; Y) ^ ((~X) &amp; Z);<br>&#125;<br>/* [<span class="hljs-number">20</span>, <span class="hljs-number">39</span>] */  /* [<span class="hljs-number">60</span>, <span class="hljs-number">79</span>] */<br>static uint32_t Parity(uint32_t X, uint32_t Y, uint32_t Z)<br>&#123;<br>    <span class="hljs-keyword">return</span> X ^ Y ^ Z;<br>&#125;<br>/* [<span class="hljs-number">40</span>, <span class="hljs-number">59</span>] */<br>static uint32_t Maj(uint32_t X, uint32_t Y, uint32_t Z)<br>&#123;<br>    <span class="hljs-keyword">return</span> (X &amp; Y) ^ (X &amp; Z) ^ (Y &amp; Z);<br>&#125;<br> <br>/* 循环向左移动offset个比特位 */<br>static uint32_t MoveLeft(uint32_t X, uint8_t offset)<br>&#123;<br>    uint32_t res = (X &lt;&lt; offset) | (X &gt;&gt; (<span class="hljs-number">32</span> - offset));<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br> <br><span class="hljs-comment">#define ASSERT_RETURN_INT(x, d) if(!(x)) &#123; return d; &#125;</span><br> <br><span class="hljs-built_in">int</span> sha1(unsigned char *out, const unsigned char* <span class="hljs-keyword">in</span>, const <span class="hljs-built_in">int</span> inlen)<br>&#123;<br>    ASSERT_RETURN_INT(out &amp;&amp; <span class="hljs-keyword">in</span> &amp;&amp; (inlen &gt;= <span class="hljs-number">0</span>), <span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>, t = <span class="hljs-number">0</span>;<br> <br>    // step <span class="hljs-number">1</span>: 字节填充(Append Padding Bytes)<br>    // 数据先补上<span class="hljs-number">1</span>个<span class="hljs-number">1</span>比特，再补上k个<span class="hljs-number">0</span>比特，使得补位后的数据比特数(n+<span class="hljs-number">1</span>+k)满足(n+<span class="hljs-number">1</span>+k) mod <span class="hljs-number">512</span> = <span class="hljs-number">448</span>，k取最小正整数<br>    <span class="hljs-built_in">int</span> iX = inlen / HASH_BLOCK_SIZE;<br>    <span class="hljs-built_in">int</span> iY = inlen % HASH_BLOCK_SIZE;<br>    iX = (iY &lt; HASH_LEN_OFFSET) ? iX : (iX + <span class="hljs-number">1</span>);<br> <br>    <span class="hljs-built_in">int</span> iLen = (iX + <span class="hljs-number">1</span>) * HASH_BLOCK_SIZE;<br>    unsigned char* X = malloc(iLen);<br>    memcpy(X, <span class="hljs-keyword">in</span>, inlen);<br>    // 先补上<span class="hljs-number">1</span>个<span class="hljs-number">1</span>比特+<span class="hljs-number">7</span>个<span class="hljs-number">0</span>比特<br>    X[inlen] = <span class="hljs-number">0x80</span>;<br>    // 再补上(k-<span class="hljs-number">7</span>)个<span class="hljs-number">0</span>比特<br>    <span class="hljs-keyword">for</span> (i = inlen + <span class="hljs-number">1</span>; i &lt; (iX * HASH_BLOCK_SIZE + HASH_LEN_OFFSET); i++)<br>    &#123;<br>        X[i] = <span class="hljs-number">0</span>;<br>    &#125;<br> <br>    // step <span class="hljs-number">2</span>: 追加长度信息(Append Length)<br>    uint8_t *pLen = (uint64_t*)(X + (iX * HASH_BLOCK_SIZE + HASH_LEN_OFFSET));<br>    uint64_t iTempLen = inlen &lt;&lt; <span class="hljs-number">3</span>;<br>    uint8_t *pTempLen = &amp;iTempLen;<br>    pLen[<span class="hljs-number">0</span>] = pTempLen[<span class="hljs-number">7</span>]; pLen[<span class="hljs-number">1</span>] = pTempLen[<span class="hljs-number">6</span>]; pLen[<span class="hljs-number">2</span>] = pTempLen[<span class="hljs-number">5</span>];  pLen[<span class="hljs-number">3</span>] = pTempLen[<span class="hljs-number">4</span>];<br>    pLen[<span class="hljs-number">4</span>] = pTempLen[<span class="hljs-number">3</span>]; pLen[<span class="hljs-number">5</span>] = pTempLen[<span class="hljs-number">2</span>]; pLen[<span class="hljs-number">6</span>] = pTempLen[<span class="hljs-number">1</span>];  pLen[<span class="hljs-number">7</span>] = pTempLen[<span class="hljs-number">0</span>];<br> <br>    // Step <span class="hljs-number">3.</span> 初始化MD Buffer(Initialize MD Buffer)<br>    uint32_t H0 = <span class="hljs-number">0x67452301</span>;   // <span class="hljs-number">0x01</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x67</span><br>    uint32_t H1 = <span class="hljs-number">0xEFCDAB89</span>;   // <span class="hljs-number">0x89</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0xEF</span><br>    uint32_t H2 = <span class="hljs-number">0x98BADCFE</span>;   // <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x98</span><br>    uint32_t H3 = <span class="hljs-number">0x10325476</span>;   // <span class="hljs-number">0x76</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x10</span><br>    uint32_t H4 = <span class="hljs-number">0xC3D2E1F0</span>;   // <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0xC3</span><br> <br>    uint32_t M[HASH_BLOCK_SIZE / <span class="hljs-number">4</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br>    uint32_t W[HASH_ROUND_NUM] = &#123; <span class="hljs-number">0</span> &#125;;<br> <br>    // step <span class="hljs-number">4</span>: 处理消息块(Process Message <span class="hljs-keyword">in</span> <span class="hljs-number">64</span>-Byte Blocks)<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; iLen / HASH_BLOCK_SIZE; i++)<br>    &#123;<br>        /* Copy block i into X. */<br>        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; HASH_BLOCK_SIZE; j = j + <span class="hljs-number">4</span>)<br>        &#123;<br>            uint64_t k = i * HASH_BLOCK_SIZE + j;<br>            M[j / <span class="hljs-number">4</span>] = (X[k] &lt;&lt; <span class="hljs-number">24</span>) | (X[k + <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">16</span>) | (X[k + <span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">8</span>) | X[k + <span class="hljs-number">3</span>];<br>        &#125;<br> <br>        /*  a. Divide M(i) into <span class="hljs-number">16</span> words W(<span class="hljs-number">0</span>), W(<span class="hljs-number">1</span>), ..., W(<span class="hljs-number">15</span>), where W(<span class="hljs-number">0</span>) <span class="hljs-keyword">is</span> the left - most word. */<br>        <span class="hljs-keyword">for</span> (t = <span class="hljs-number">0</span>; t &lt;= <span class="hljs-number">15</span>; t++)<br>        &#123;<br>            W[t] = M[t];<br>        &#125;<br> <br>        /*  b. For t = <span class="hljs-number">16</span> to <span class="hljs-number">79</span> let<br>        W(t) = S^<span class="hljs-number">1</span>(W(t-<span class="hljs-number">3</span>) XOR W(t-<span class="hljs-number">8</span>) XOR W(t-<span class="hljs-number">14</span>) XOR W(t-<span class="hljs-number">16</span>)). */<br>        <span class="hljs-keyword">for</span> (t = <span class="hljs-number">16</span>; t &lt;= <span class="hljs-number">79</span>; t++)<br>        &#123;<br>            W[t] = MoveLeft(W[t - <span class="hljs-number">3</span>] ^ W[t - <span class="hljs-number">8</span>] ^ W[t - <span class="hljs-number">14</span>] ^ W[t - <span class="hljs-number">16</span>], <span class="hljs-number">1</span>);<br>        &#125;<br> <br>        /*  c. Let A = H0, B = H1, C = H2, D = H3, E = H4. */<br>        uint32_t A = H0;<br>        uint32_t B = H1;<br>        uint32_t C = H2;<br>        uint32_t D = H3;<br>        uint32_t E = H4;<br> <br>        /*  d. For t = <span class="hljs-number">0</span> to <span class="hljs-number">79</span> do<br>        TEMP = S^<span class="hljs-number">5</span>(A) + f(t;B,C,D) + E + W(t) + K(t);<br>        E = D;  D = C;  C = S^<span class="hljs-number">30</span>(B);  B = A; A = TEMP; */<br>        <span class="hljs-keyword">for</span> (t = <span class="hljs-number">0</span>; t &lt;= <span class="hljs-number">19</span>; t++)<br>        &#123;<br>            uint32_t temp = MoveLeft(A, <span class="hljs-number">5</span>) + Ch(B, C, D) + E + W[t] + K[<span class="hljs-number">0</span>];<br>            E = D;<br>            D = C;<br>            C = MoveLeft(B, <span class="hljs-number">30</span>);<br>            B = A;<br>            A = temp;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (t = <span class="hljs-number">20</span>; t &lt;= <span class="hljs-number">39</span>; t++)<br>        &#123;<br>            uint32_t temp = MoveLeft(A, <span class="hljs-number">5</span>) + Parity(B, C, D) + E + W[t] + K[<span class="hljs-number">1</span>];<br>            E = D;<br>            D = C;<br>            C = MoveLeft(B, <span class="hljs-number">30</span>);<br>            B = A;<br>            A = temp;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (t = <span class="hljs-number">40</span>; t &lt;= <span class="hljs-number">59</span>; t++)<br>        &#123;<br>            uint32_t temp = MoveLeft(A, <span class="hljs-number">5</span>) + Maj(B, C, D) + E + W[t] + K[<span class="hljs-number">2</span>];<br>            E = D;<br>            D = C;<br>            C = MoveLeft(B, <span class="hljs-number">30</span>);<br>            B = A;<br>            A = temp;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (t = <span class="hljs-number">60</span>; t &lt;= <span class="hljs-number">79</span>; t++)<br>        &#123;<br>            uint32_t temp = MoveLeft(A, <span class="hljs-number">5</span>) + Parity(B, C, D) + E + W[t] + K[<span class="hljs-number">3</span>];<br>            E = D;<br>            D = C;<br>            C = MoveLeft(B, <span class="hljs-number">30</span>);<br>            B = A;<br>            A = temp;<br>        &#125;<br> <br>        /*  e. Let H0 = H0 + A, H1 = H1 + B, H2 = H2 + C, H3 = H3 + D, H4 = H4 + E. */<br>        H0 = H0 + A;<br>        H1 = H1 + B;<br>        H2 = H2 + C;<br>        H3 = H3 + D;<br>        H4 = H4 + E;<br>    &#125;<br> <br>    // step <span class="hljs-number">5</span>: 输出ABCD<br>    uint32_t* pOut = (uint8_t*)out;<br>    pOut[<span class="hljs-number">0</span>] = __bswap_32(H0);<br>    pOut[<span class="hljs-number">1</span>] = __bswap_32(H1);<br>    pOut[<span class="hljs-number">2</span>] = __bswap_32(H2);<br>    pOut[<span class="hljs-number">3</span>] = __bswap_32(H3);<br>    pOut[<span class="hljs-number">4</span>] = __bswap_32(H4);<br>    free(X);<br> <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br> <br><span class="hljs-built_in">int</span> main()<br>&#123;<br>    unsigned char digest[<span class="hljs-number">20</span>] = &#123; <span class="hljs-number">0</span> &#125;;<br> <br>    sha1(digest, <span class="hljs-string">&quot;Hello World!&quot;</span>, strlen(<span class="hljs-string">&quot;Hello World!&quot;</span>));<br> <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="祖冲之（ZUC"><a href="#祖冲之（ZUC" class="headerlink" title="祖冲之（ZUC)"></a>祖冲之（ZUC)</h1><p>序列密码，参考加解密脚本，需要已知key和iv</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> ceil<br> <br>S0 = [<br>    <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0xCB</span>,<br>    <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x90</span>,<br>    <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0xAC</span>,<br>    <span class="hljs-number">0xCD</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x38</span>,<br>    <span class="hljs-number">0x76</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x9B</span>,<br>    <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x1C</span>,<br>    <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0xAD</span>,<br>    <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0xC8</span>,<br>    <span class="hljs-number">0xB1</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x56</span>,<br>    <span class="hljs-number">0x07</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xFE</span>,<br>    <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0x5D</span>,<br>    <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0x23</span>,<br>    <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0xF1</span>,<br>    <span class="hljs-number">0xF6</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x0F</span>,<br>    <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x65</span>,<br>    <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x60</span><br>]<br> <br>S1 = [<br>    <span class="hljs-number">0x55</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0x77</span>,<br>    <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0x42</span>,<br>    <span class="hljs-number">0x44</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xE1</span>,<br>    <span class="hljs-number">0x3A</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x48</span>,<br>    <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x87</span>,<br>    <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0xD6</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0xEB</span>,<br>    <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0xA1</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x08</span>, <span class="hljs-number">0x09</span>,<br>    <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0xA9</span>,<br>    <span class="hljs-number">0xAD</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0xE9</span>,<br>    <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x9E</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x89</span>,<br>    <span class="hljs-number">0x01</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x99</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xE4</span>,<br>    <span class="hljs-number">0xD0</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0xDE</span>,<br>    <span class="hljs-number">0xA3</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x51</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xFF</span>, <span class="hljs-number">0x21</span>,<br>    <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xBA</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x34</span>,<br>    <span class="hljs-number">0x88</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x28</span>,<br>    <span class="hljs-number">0x64</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x85</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x8A</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0xF2</span><br>]<br> <br>D = [<br>    <span class="hljs-number">0x44D7</span>, <span class="hljs-number">0x26BC</span>, <span class="hljs-number">0x626B</span>, <span class="hljs-number">0x135E</span>, <span class="hljs-number">0x5789</span>, <span class="hljs-number">0x35E2</span>, <span class="hljs-number">0x7135</span>, <span class="hljs-number">0x09AF</span>,<br>    <span class="hljs-number">0x4D78</span>, <span class="hljs-number">0x2F13</span>, <span class="hljs-number">0x6BC4</span>, <span class="hljs-number">0x1AF1</span>, <span class="hljs-number">0x5E26</span>, <span class="hljs-number">0x3C4D</span>, <span class="hljs-number">0x789A</span>, <span class="hljs-number">0x47AC</span><br>]<br> <br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">addition_uint31</span>(<span class="hljs-params">a, b</span>):<br>    c = a + b<br>    <span class="hljs-keyword">return</span> (c &amp; <span class="hljs-number">0x7FFFFFFF</span>) + (c &gt;&gt; <span class="hljs-number">31</span>)<br> <br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rotl_uint31</span>(<span class="hljs-params">a, shift</span>):<br>    <span class="hljs-keyword">return</span> ((a &lt;&lt; shift) | (a &gt;&gt; (<span class="hljs-number">31</span> - shift))) &amp; <span class="hljs-number">0x7FFFFFFF</span><br> <br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rotl_uint32</span>(<span class="hljs-params">a, shift</span>):<br>    <span class="hljs-keyword">return</span> ((a &lt;&lt; shift) | (a &gt;&gt; (<span class="hljs-number">32</span> - shift))) &amp; <span class="hljs-number">0xFFFFFFFF</span><br> <br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">l1</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> (x ^ rotl_uint32(x, <span class="hljs-number">2</span>) ^ rotl_uint32(x, <span class="hljs-number">10</span>) ^ rotl_uint32(x, <span class="hljs-number">18</span>) ^ rotl_uint32(x, <span class="hljs-number">24</span>))<br> <br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">l2</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> (x ^ rotl_uint32(x, <span class="hljs-number">8</span>) ^ rotl_uint32(x, <span class="hljs-number">14</span>) ^ rotl_uint32(x, <span class="hljs-number">22</span>) ^ rotl_uint32(x, <span class="hljs-number">30</span>))<br> <br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_uint32</span>(<span class="hljs-params">a, b, c, d</span>):<br>    <span class="hljs-keyword">return</span> ((a &lt;&lt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xffffffff</span>) | ((b &lt;&lt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xffffffff</span>) | ((c &lt;&lt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xffffffff</span>) | d<br> <br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_uint31</span>(<span class="hljs-params">a, b, c</span>):<br>    <span class="hljs-keyword">return</span> ((a &lt;&lt; <span class="hljs-number">23</span>) &amp; <span class="hljs-number">0x7fffffff</span>) | ((b &lt;&lt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0x7fffffff</span>) | c<br> <br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ZUC</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, key, iv</span>):<br>        self.r = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br>        self.lfsr = [<span class="hljs-number">0</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>)]<br>        self.x = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br>        self.zuc_init(key, iv)<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bit_reorganization</span>(<span class="hljs-params">self</span>):<br>        self.x[<span class="hljs-number">0</span>] = ((self.lfsr[<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0x7FFF8000</span>) &lt;&lt; <span class="hljs-number">1</span>) | (self.lfsr[<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xFFFF</span>)<br>        self.x[<span class="hljs-number">1</span>] = ((self.lfsr[<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xFFFF</span>) &lt;&lt; <span class="hljs-number">16</span>) | (self.lfsr[<span class="hljs-number">9</span>] &gt;&gt; <span class="hljs-number">15</span>)<br>        self.x[<span class="hljs-number">2</span>] = ((self.lfsr[<span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xFFFF</span>) &lt;&lt; <span class="hljs-number">16</span>) | (self.lfsr[<span class="hljs-number">5</span>] &gt;&gt; <span class="hljs-number">15</span>)<br>        self.x[<span class="hljs-number">3</span>] = ((self.lfsr[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xFFFF</span>) &lt;&lt; <span class="hljs-number">16</span>) | (self.lfsr[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">15</span>)<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lfsr_next</span>(<span class="hljs-params">self</span>):<br>        f = self.lfsr[<span class="hljs-number">0</span>]<br>        v = rotl_uint31(self.lfsr[<span class="hljs-number">0</span>], <span class="hljs-number">8</span>)<br>        f = addition_uint31(f, v)<br>        v = rotl_uint31(self.lfsr[<span class="hljs-number">4</span>], <span class="hljs-number">20</span>)<br>        f = addition_uint31(f, v)<br>        v = rotl_uint31(self.lfsr[<span class="hljs-number">10</span>], <span class="hljs-number">21</span>)<br>        f = addition_uint31(f, v)<br>        v = rotl_uint31(self.lfsr[<span class="hljs-number">13</span>], <span class="hljs-number">17</span>)<br>        f = addition_uint31(f, v)<br>        v = rotl_uint31(self.lfsr[<span class="hljs-number">15</span>], <span class="hljs-number">15</span>)<br>        f = addition_uint31(f, v)<br>        <span class="hljs-keyword">return</span> f<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lfsr_append</span>(<span class="hljs-params">self, f</span>):<br>        self.lfsr.append(f)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.lfsr) &gt; <span class="hljs-number">16</span>:<br>            self.lfsr.pop(<span class="hljs-number">0</span>)<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lfsr_init</span>(<span class="hljs-params">self, u</span>):<br>        self.lfsr_append(addition_uint31(self.lfsr_next(), u))<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lfsr_shift</span>(<span class="hljs-params">self</span>):<br>        self.lfsr_append(self.lfsr_next())<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">self</span>):<br>        W = ((self.x[<span class="hljs-number">0</span>] ^ self.r[<span class="hljs-number">0</span>]) + self.r[<span class="hljs-number">1</span>]) &amp; <span class="hljs-number">0xffffffff</span><br>        W1 = (self.r[<span class="hljs-number">0</span>] + self.x[<span class="hljs-number">1</span>]) &amp; <span class="hljs-number">0xffffffff</span><br>        W2 = self.r[<span class="hljs-number">1</span>] ^ self.x[<span class="hljs-number">2</span>]<br>        u = l1(((W1 &amp; <span class="hljs-number">0x0000ffff</span>) &lt;&lt; <span class="hljs-number">16</span>) | (W2 &gt;&gt; <span class="hljs-number">16</span>))<br>        v = l2(((W2 &amp; <span class="hljs-number">0x0000ffff</span>) &lt;&lt; <span class="hljs-number">16</span>) | (W1 &gt;&gt; <span class="hljs-number">16</span>))<br>        self.r = [make_uint32(S0[u &gt;&gt; <span class="hljs-number">24</span>], S1[(u &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>],<br>                              S0[(u &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>], S1[u &amp; <span class="hljs-number">0xFF</span>]),<br>                  make_uint32(S0[v &gt;&gt; <span class="hljs-number">24</span>], S1[(v &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>],<br>                              S0[(v &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>], S1[v &amp; <span class="hljs-number">0xFF</span>])]<br>        <span class="hljs-keyword">return</span> W<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">zuc_init</span>(<span class="hljs-params">self, key, iv</span>):<br>        <span class="hljs-comment"># Expand key.</span><br>        self.lfsr = [make_uint31(key[i], D[i], iv[i]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>)]<br>        self.r = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>            self.bit_reorganization()<br>            w = self.f()<br>            self.lfsr_init(w &gt;&gt; <span class="hljs-number">1</span>)<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">zuc_generate_keystream</span>(<span class="hljs-params">self, length</span>):<br>        keystream_buffer = []<br>        self.bit_reorganization()<br>        self.f()  <span class="hljs-comment"># Discard the output of F.</span><br> <br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">itor</span>():<br>            self.lfsr_shift()<br>            self.bit_reorganization()<br>            <span class="hljs-keyword">return</span> self.f() ^ self.x[-<span class="hljs-number">1</span>]<br> <br>        keystream_buffer = [itor() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length)]<br>        self.lfsr_shift()<br>        <span class="hljs-keyword">return</span> keystream_buffer<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">zuc_encrypt</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):<br>        length = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">input</span>)<br>        key_stream = self.zuc_generate_keystream(length)<br>        <span class="hljs-keyword">return</span> [inp ^ key_stream[i] <span class="hljs-keyword">for</span> i, inp <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">input</span>)]<br> <br> <br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;__main__&#x27;</span> == __name__:<br>    key = [<span class="hljs-number">0x00</span>] * <span class="hljs-number">16</span><br>    iv = [<span class="hljs-number">0x00</span>] * <span class="hljs-number">16</span><br>    zuc = ZUC(key, iv)<br>    <span class="hljs-comment"># 加密过程</span><br>    out = zuc.zuc_encrypt(<span class="hljs-string">b&quot;i love u&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;加密得到的字流&quot;</span>, [<span class="hljs-string">&quot;%08x&quot;</span> % e <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> out])<br>    <span class="hljs-comment"># 解密过程</span><br>    zuc2 = ZUC(key, iv)<br>    out2 = zuc2.zuc_encrypt(out)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解密得到的字流&quot;</span>, [<span class="hljs-string">&quot;%08x&quot;</span> % e <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> out2])<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(out2))<br></code></pre></td></tr></table></figure>

<h1 id="base58"><a href="#base58" class="headerlink" title="base58"></a>base58</h1><p>基本思想：常⽤的字节码（256进制）转换成Base58，相当于将256进制转换成58进制</p>
<p>经典脚本，表的长度是61，1-9+大小写字母，一般会多次出现58</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103498182-3d0c05cf-4c62-4494-bbc2-b27a572b65a5.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>也有这样的</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1725501074874-fc0b4761-a24b-4adc-afc3-f4b0b6a3c249.png" srcset="/img/loading.gif" lazyload class="" title="img">



<p>编码过程是：</p>
<p>\1. 将要转换的数据转换为字节数组</p>
<p>\2. 计算前置字节码是0的个数，因为0没必要参与转换，其结果是0。</p>
<p>\3. 将256进制转换为10进制</p>
<p>\4. 将10进制转换为58进制。</p>
<p>\5. 得到⼀个58进制的数组，将第⼆步0的个数添加到该数组末尾。n个0就添加n个0到数组末尾。</p>
<p>\6. 反转整个数组。</p>
<p>\7. 查表，将base58编码转换成字符。</p>
<p>这⾥的第3步如果转换的字节数组很⻓，那么以256为底数的指数将会⾮常庞⼤，需要使⽤⼤数，但实际上可以优化算法，没必要⼀次性将整个原始数组全部转换为10进制后才转换为58进制，可采取逐个转换为58进制的策略来进⾏，这样可以避免使⽤⼤整数，从⽽提⾼运算效率。</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103402878-be9876fd-04a6-4b39-a984-52ab209107e4.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103416136-af46dec2-60b8-4619-aa55-f6cadad1bd36.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103463789-7bf66485-cad1-4bf6-a032-39ce1dc72964.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706103475369-340dd3c5-c871-4c84-bedd-50d61dc77bf7.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>base58不需要key也能解出来</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706107904227-c3a6d88e-7b48-4070-bd1c-5465956dc73e.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1706107881056-e7eac23e-dab4-4df1-b478-42c4ffd3a376.png" srcset="/img/loading.gif" lazyload class="" title="img">





<h1 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a><strong>斐波那契数列</strong></h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c">v1 = fib_start;<br>v2 = &amp;xmmword_408040;<br>xmmword_408040 = (__int128)_mm_load_si128((<span class="hljs-type">const</span> __m128i *)&amp;xmmword_405050);<br>v3 = dword_404010 + <span class="hljs-number">4</span>;<br><span class="hljs-keyword">do</span><br>&#123;<br>  v4 = v1;<br>  <span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">0</span> )<br>  &#123;<br>    v12 = <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    v5 = <span class="hljs-number">0</span>;<br>    v6 = <span class="hljs-number">0</span>;<br>    v7 = <span class="hljs-number">1</span>;<br>    v8 = <span class="hljs-number">1</span>;<br>    v9 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">do</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( (v4 &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>      &#123;<br>        v10 = v6;<br>        v6 = v7 * v8 + v5 * v6;<br>        v8 = v7 * v10 + v9 * v8;<br>      &#125;<br>      v11 = v7 * v7;<br>      v7 *= v5 + v9;<br>      v5 = v11 + v5 * v5;<br>      v4 &gt;&gt;= <span class="hljs-number">1</span>;<br>      v9 = v9 * v9 + v11;<br>    &#125;<br>    <span class="hljs-keyword">while</span> ( v4 );<br>    v12 = v8;<br>  &#125;<br>  ++v1;<br>  *(_DWORD *)v2 = v12;<br>  v2 = (__int128 *)((<span class="hljs-type">char</span> *)v2 + <span class="hljs-number">4</span>);<br>&#125;<br><span class="hljs-keyword">while</span> ( v1 != v3 );<br></code></pre></td></tr></table></figure>



<h1 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h1><p>国际数据加密算法</p>
<p>IDEA是块加密，与DES一样，IDEA也处理64位明文块，但是其密钥有128位，IDEA也用扩展与混淆进行加密</p>
<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721799956770-becace1d-55fb-472a-b818-fbd656562907.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721800105335-3a90d6e8-abb9-4ff4-83a7-72424adfddd0.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/01/09/Reverse%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/1721800125836-0324cd07-7174-40b2-93bd-d6a3e21527e5.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>能看到0xffff，还有65537，还有加，异或的运算</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">__uint32_t</span> <span class="hljs-type">uint32_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">__int32_t</span> <span class="hljs-type">int32_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">__uint16_t</span> <span class="hljs-type">uint16_t</span>;<br><span class="hljs-keyword">typedef</span> <span class="hljs-title function_">void</span> <span class="hljs-params">(*idea_gen_key)</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span>[<span class="hljs-number">52</span>], <span class="hljs-type">uint16_t</span>[<span class="hljs-number">8</span>])</span>;<br><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">mulMod65537</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> a, <span class="hljs-type">uint16_t</span> b)</span> &#123;<br>    <span class="hljs-type">uint32_t</span> c;<br>    <span class="hljs-type">uint16_t</span> hi, lo;<br><br>    <span class="hljs-keyword">if</span> (a == <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> -b + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> -a + <span class="hljs-number">1</span>;<br><br>    c = (<span class="hljs-type">uint32_t</span>)a * (<span class="hljs-type">uint32_t</span>)b;<br>    hi = c &gt;&gt; <span class="hljs-number">16</span>;<br>    lo = c;<br><br>    <span class="hljs-keyword">if</span> (lo &gt; hi)<br>        <span class="hljs-keyword">return</span> lo - hi;<br>    <span class="hljs-keyword">return</span> lo - hi + <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">modInverse</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> m)</span> &#123;<br>    <span class="hljs-type">int</span> m0 = m, t, q;<br>    <span class="hljs-type">int</span> x0 = <span class="hljs-number">0</span>, x1 = <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">if</span> (m == <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">while</span> (a &gt; <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// q is quotient</span><br>        q = a / m;<br>        t = m;<br><br>        <span class="hljs-comment">// m is remainder now, process same as</span><br>        <span class="hljs-comment">// Euclid&#x27;s algo</span><br>        m = a % m;<br>        a = t;<br><br>        t = x0;<br>        x0 = x1 - q * x0;<br>        x1 = t;<br>    &#125;<br><br>    <span class="hljs-comment">// Make x1 positive</span><br>    <span class="hljs-keyword">if</span> (x1 &lt; <span class="hljs-number">0</span>)<br>        x1 += m0;<br><br>    <span class="hljs-keyword">return</span> x1;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">encrypt</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> subKey[<span class="hljs-number">52</span>], <span class="hljs-type">uint16_t</span> key[<span class="hljs-number">8</span>])</span> &#123;<br>    <span class="hljs-type">int</span> i;<br><br>    <span class="hljs-comment">// Generate encryption keys</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">52</span>; i++) &#123;<br>        <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">8</span>)<br>            subKey[i] = key[i];<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i % <span class="hljs-number">8</span> == <span class="hljs-number">6</span>)<br>            subKey[i] = (subKey[i - <span class="hljs-number">7</span>] &lt;&lt; <span class="hljs-number">9</span>) | (subKey[i - <span class="hljs-number">14</span>] &gt;&gt; <span class="hljs-number">7</span>);<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i % <span class="hljs-number">8</span> == <span class="hljs-number">7</span>)<br>            subKey[i] = (subKey[i - <span class="hljs-number">15</span>] &lt;&lt; <span class="hljs-number">9</span>) | (subKey[i - <span class="hljs-number">14</span>] &gt;&gt; <span class="hljs-number">7</span>);<br>        <span class="hljs-keyword">else</span><br>            subKey[i] = (subKey[i - <span class="hljs-number">7</span>] &lt;&lt; <span class="hljs-number">9</span>) | (subKey[i - <span class="hljs-number">6</span>] &gt;&gt; <span class="hljs-number">7</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">decrypt</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> subKey[<span class="hljs-number">52</span>], <span class="hljs-type">uint16_t</span> key[<span class="hljs-number">8</span>])</span> &#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">uint16_t</span> K[<span class="hljs-number">52</span>];<br><br>    <span class="hljs-comment">// Compute encryption keys</span><br>    encrypt(K, key);<br><br>    <span class="hljs-comment">// Generate dencryption keys</span><br>    subKey[<span class="hljs-number">0</span>] = modInverse(K[<span class="hljs-number">48</span>], <span class="hljs-number">65537</span>);<br>    subKey[<span class="hljs-number">1</span>] = -K[<span class="hljs-number">49</span>];<br>    subKey[<span class="hljs-number">2</span>] = -K[<span class="hljs-number">50</span>];<br>    subKey[<span class="hljs-number">3</span>] = modInverse(K[<span class="hljs-number">51</span>], <span class="hljs-number">65537</span>);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Keys: %04X %04X %04X %04Xn&quot;</span>, subKey[<span class="hljs-number">0</span>], subKey[<span class="hljs-number">1</span>], subKey[<span class="hljs-number">2</span>],<br>         subKey[<span class="hljs-number">3</span>]);<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">4</span>; i &lt; <span class="hljs-number">52</span>; i += <span class="hljs-number">6</span>) &#123;<br>        subKey[i + <span class="hljs-number">0</span>] = K[<span class="hljs-number">52</span> - i - <span class="hljs-number">2</span>];<br>        subKey[i + <span class="hljs-number">1</span>] = K[<span class="hljs-number">52</span> - i - <span class="hljs-number">1</span>];<br><br>        subKey[i + <span class="hljs-number">2</span>] = modInverse(K[<span class="hljs-number">52</span> - i - <span class="hljs-number">6</span>], <span class="hljs-number">65537</span>);<br>        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">46</span>) &#123;<br>            subKey[i + <span class="hljs-number">3</span>] = -K[<span class="hljs-number">52</span> - i - <span class="hljs-number">5</span>];<br>            subKey[i + <span class="hljs-number">4</span>] = -K[<span class="hljs-number">52</span> - i - <span class="hljs-number">4</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            subKey[i + <span class="hljs-number">3</span>] = -K[<span class="hljs-number">52</span> - i - <span class="hljs-number">4</span>];<br>            subKey[i + <span class="hljs-number">4</span>] = -K[<span class="hljs-number">52</span> - i - <span class="hljs-number">5</span>];<br>        &#125;<br>        subKey[i + <span class="hljs-number">5</span>] = modInverse(K[<span class="hljs-number">52</span> - i - <span class="hljs-number">3</span>], <span class="hljs-number">65537</span>);<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Keys: %04X %04X %04X %04X %04X %04Xn&quot;</span>, subKey[i], subKey[i + <span class="hljs-number">1</span>],<br>           subKey[i + <span class="hljs-number">2</span>], subKey[i + <span class="hljs-number">3</span>], subKey[i + <span class="hljs-number">4</span>], subKey[i + <span class="hljs-number">5</span>]);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">IDEA</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> data[<span class="hljs-number">4</span>], <span class="hljs-type">uint16_t</span> key[<span class="hljs-number">8</span>], idea_gen_key func)</span> &#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">uint16_t</span> subKey[<span class="hljs-number">52</span>];<br><br>    <span class="hljs-comment">// Generate keys</span><br>    func(subKey, key);<br><br>    <span class="hljs-type">uint16_t</span> X0 = data[<span class="hljs-number">0</span>];<br>    <span class="hljs-type">uint16_t</span> X1 = data[<span class="hljs-number">1</span>];<br>    <span class="hljs-type">uint16_t</span> X2 = data[<span class="hljs-number">2</span>];<br>    <span class="hljs-type">uint16_t</span> X3 = data[<span class="hljs-number">3</span>];<br>    <span class="hljs-type">uint16_t</span> tmp1, tmp2;<br><br>    <span class="hljs-comment">// Apply 8 rounds</span><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d:   %04X %04X %04X %04Xn&quot;</span>, i, X0, X1, X2, X3);<br><br>        X0 = mulMod65537(X0, subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">0</span>]);  <span class="hljs-comment">// Step 1</span><br>        X1 += subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">1</span>];                  <span class="hljs-comment">// Step 2</span><br>        X2 += subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">2</span>];                  <span class="hljs-comment">// Step 3</span><br>        X3 = mulMod65537(X3, subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">3</span>]);  <span class="hljs-comment">// Step 4</span><br><br>        tmp1 = X0 ^ X2;  <span class="hljs-comment">// Step 5</span><br>        tmp2 = X1 ^ X3;  <span class="hljs-comment">// Step 6</span><br><br>        tmp1 = mulMod65537(tmp1, subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">4</span>]);  <span class="hljs-comment">// Step 7</span><br>        tmp2 += tmp1;                                 <span class="hljs-comment">// Step 8</span><br>        tmp2 = mulMod65537(tmp2, subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">5</span>]);  <span class="hljs-comment">// Step 9</span><br>        tmp1 += tmp2;                                 <span class="hljs-comment">// Step 10</span><br><br>        X0 ^= tmp2;<br>        X1 ^= tmp1;<br>        X2 ^= tmp2;<br>        X3 ^= tmp1;<br><br>        <span class="hljs-comment">// Swap X1 and X2</span><br>        tmp1 = X1;<br>        X1 = X2;<br>        X2 = tmp1;<br>    &#125;<br><br>    tmp1 = X1;<br>    tmp2 = X2;<br><br>    <span class="hljs-comment">// Apply the half round</span><br>    data[<span class="hljs-number">0</span>] = mulMod65537(X0, subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">0</span>]);<br>    data[<span class="hljs-number">1</span>] = tmp2 + subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">1</span>];<br>    data[<span class="hljs-number">2</span>] = tmp1 + subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">2</span>];<br>    data[<span class="hljs-number">3</span>] = mulMod65537(X3, subKey[<span class="hljs-number">6</span> * i + <span class="hljs-number">3</span>]);<br>&#125;<br><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">binToInt</span><span class="hljs-params">(<span class="hljs-type">char</span>* str)</span> &#123;<br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-type">uint16_t</span> size = <span class="hljs-built_in">strlen</span>(str);<br>    <span class="hljs-type">uint16_t</span> result = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">uint16_t</span> <span class="hljs-built_in">pow</span> = <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">for</span> (i = size - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>        <span class="hljs-keyword">if</span> (str[i] == <span class="hljs-string">&#x27;1&#x27;</span>)<br>            result += <span class="hljs-built_in">pow</span>;<br>        <span class="hljs-built_in">pow</span> *= <span class="hljs-number">2</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">convertStringToBin</span><span class="hljs-params">(<span class="hljs-type">char</span>* str, <span class="hljs-type">uint16_t</span>* data, <span class="hljs-type">uint16_t</span> size)</span> &#123;<br>    <span class="hljs-type">int</span> i, j = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> sizeBlock = <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">uint16_t</span>) * <span class="hljs-number">8</span>;<br>    <span class="hljs-type">char</span> block[sizeBlock + <span class="hljs-number">1</span>];<br><br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">strlen</span>(str) &amp;&amp; i &lt; size * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">uint16_t</span>);<br>       i += <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">uint16_t</span>)) &#123;<br>        <span class="hljs-built_in">strncpy</span>(block, str, sizeBlock);<br>        block[sizeBlock] = <span class="hljs-string">&#x27;&#x27;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        data[j++] = binToInt(block);</span><br><span class="hljs-string">        str += sizeBlock;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">int main() &#123;</span><br><span class="hljs-string">    char Data[] =</span><br><span class="hljs-string">        &quot;110111110100101101010100100010011000110001010001000000000000111011100000110011110000101001011001100001110000100010010110011011110011110010100010111100110011010000010110101101000111101011110111101001000110000010100001110101111100101000111010101110000100100011101100100101100110000011000111100010010000001001001001100000110111101111100011100011111111001001101111100010010100000101010111&quot;;</span><br><span class="hljs-string">    char Key[128] = &quot;01001110110010000111010101010110110101111011111010101001010010001011100010011110101000111100011111000010111100010011110000101110&quot;;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    uint16_t data[4*6];</span><br><span class="hljs-string">    uint16_t key[8];</span><br><span class="hljs-string"></span><br><span class="hljs-string">    convertStringToBin(Data, data, 4*6);</span><br><span class="hljs-string">    convertStringToBin(Key, key, 8);</span><br><span class="hljs-string">    for(int i=0;i&lt;8;i++)&#123;</span><br><span class="hljs-string">        printf(&quot;%x&quot;,key[i]);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    // Print initial data</span><br><span class="hljs-string">    printf(&quot;Initial data:   %04X %04X %04X %04Xn&quot;, data[0], data[1], data[2],</span><br><span class="hljs-string">         data[3]);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    // Encrypt data</span><br><span class="hljs-string">    // IDEA(data, key, encrypt);</span><br><span class="hljs-string">    // printf(&quot;Encrypted data: %04X %04X %04X %04Xn&quot;, data[0], data[1], data[2],</span><br><span class="hljs-string">    //      data[3]);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    // Decrypt data</span><br><span class="hljs-string">    for(int i=0;i&lt;6;i++) IDEA(data+4*i, key, decrypt);</span><br><span class="hljs-string">    for(int i=0;i&lt;24;i++) printf(&quot;%02x&quot;,data[i]);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    return 0;</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/" class="category-chain-item">知识点</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Reverse常见算法</div>
      <div>https://j1ya-22.github.io/2025/01/09/Reverse常见算法/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>j1ya</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年1月9日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/02/05/patch-used-for-a-reverse-problem-named-sm4-in-MoeCTF2024/" title="patch used for a reverse problem named sm4 in MoeCTF2024">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">patch used for a reverse problem named sm4 in MoeCTF2024</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/01/09/codeQL%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/" title="codeQL静态分析">
                        <span class="hidden-mobile">codeQL静态分析</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"5oPqGOgpqzM186wdJq3YyrcV-gzGzoHsz","appKey":"tdZv3tC3tP1IszSKxEodRe6e","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
