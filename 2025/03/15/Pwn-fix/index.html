

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="j1ya">
  <meta name="keywords" content="">
  
    <meta name="description" content="https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;13881?time__1311&#x3D;mqmxnQG%3DIxyD2DBqDTlxxuGITumAYD&amp;alichlgref&#x3D;https%3A%2F%2Fcn.bing.com%2F 1python evilPatcher.py pwn sandboxs&#x2F;sandbox1.asm 1  patch7.7的ida Keypatcher可以直接修改汇">
<meta property="og:type" content="article">
<meta property="og:title" content="Pwn_fix">
<meta property="og:url" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/index.html">
<meta property="og:site_name" content="j1ya">
<meta property="og:description" content="https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;13881?time__1311&#x3D;mqmxnQG%3DIxyD2DBqDTlxxuGITumAYD&amp;alichlgref&#x3D;https%3A%2F%2Fcn.bing.com%2F 1python evilPatcher.py pwn sandboxs&#x2F;sandbox1.asm 1  patch7.7的ida Keypatcher可以直接修改汇">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713404151277-584a9740-d07e-42b8-bb51-f4802e0e89ef.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740275445302-3e84cffb-6677-4849-814d-956fcf0372bf.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1724208290255-e435a191-657f-4e3a-8b3e-eb1b2276b9ae.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740277743788-533c89f6-3da7-49ca-9b1f-9ca6eeab2418.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1717602702582-7b98e378-6857-41bb-9097-b97d2cdae3b3.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1687358670407-1734d32e-1624-4ad3-8fb9-761c25ba0408.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1687358848340-197f1b42-62fc-4d8c-bc6c-75c907066094.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1687169579312-afdf55f5-7346-495b-9752-d29d26d176f9.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1741934520520-25d90208-dc16-40ba-995c-1bc48f6c302a.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489098736-d6a81e9a-8e5a-4a10-9e9f-28f40652305e.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489500925-cd9d9b9c-65e0-46a8-ac71-6af7468a3dd1.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489501079-12fb76b6-46f8-48a6-b4e1-155b6d71ea5a.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489500935-40532edb-6e95-4ce3-b061-d63aefdbce1c.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489501021-cd672b1f-63bf-4d37-b11c-cbdfd74c8234.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489501706-e1ef937c-de3c-445e-aaee-c52af86d3ebf.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489501705-fc60a083-4299-4a63-a270-6a6708dfd8bd.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740405874686-76c33a3c-fb8c-4beb-81b5-05fb4376682d.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740400328044-901bc7ce-65dd-4e70-a0e7-35a509172669.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740400380530-1754c3ab-c3cb-48eb-a3fd-a145fe2b5ca1.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740405863303-64225fc5-002c-4eb6-8367-6efadd7362da.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740450657032-b9f6c1ab-e151-456b-810a-0fe54e57f547.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740405657726-833c2835-10f8-49b3-b620-e9a1f2ea8f3c.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740405674980-fb09c9d7-b87a-4888-a30a-8e95f2ac7481.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740405480305-8970392f-4ad9-4ae6-8cf1-e7261d219fdb.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1710549753112-ca4a6f18-a929-44ee-a59c-f24070436a1b.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1710501367023-420e8800-9c4e-4c92-a4e7-13f8edac75fe.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1710501499855-a8f32303-73be-4e61-8300-4337962359bc.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1710501858792-a23418bd-2aad-41b9-a1c0-ee71172c6d15.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740277559808-41de466f-a00f-466f-8f79-22b92d450523.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1710549682047-f28357c2-b925-44d7-a7ba-99bfdd87d5fc.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489915539-febdc2eb-43d0-4f49-9889-ec8304a2b348.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489915459-f26e378a-c77b-463f-b24f-55624c4d57a2.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713489915481-955f1161-a9c0-4deb-ac6a-d23cd5c86e41.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1711270889039-b1ecb5f5-30f2-4ef9-b60f-b60769e4af42.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1721099776048-002d4306-f46e-4e8a-9bea-641838f0b660.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1721099808872-50215e30-3ddc-405b-8453-7c750ec14a97.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1721031940652-1cb20ae6-b66f-4469-ad36-0730ca046713.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1721032005547-95837619-6c0f-4f8a-bf21-59de84091ea9.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1741921914741-4845f033-abeb-4e4b-8786-1fcdc74b405a.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713406214307-76909e37-d204-42cd-b88d-1cee41bba374.jpeg">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713406214189-2625844a-f628-40e2-ba1c-d4322999bc01.jpeg">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713406214196-88d68a78-25c5-4527-b037-c765fb0339d4.jpeg">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740742873574-0e31fbc0-0b3e-4f59-9963-647ec1c9f128.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740466819436-38f263ec-70ca-41f2-871e-1303b4e6b6fa.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740467059859-2ffbd8e9-b9f6-47b9-85d7-0373c7b58b52.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1741865511685-a08bd76f-d6a6-455a-a2ef-86382512190a.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740453092636-6f14668b-2da6-4cde-9117-ca2406adca32.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740467452039-30ba8060-8897-4919-a769-c4e8588b6611.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740467472685-a4eab699-7f59-4c01-898c-291cc571b46e.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740467957703-00404bec-9785-4e50-a700-3b8cca613cd5.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740473504405-e31668e4-4964-4c6d-91b0-56bca33f588b.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1739065756868-39cad9f0-0116-4884-a5e0-a6dee089e627.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1717775588631-e897367d-b5cb-4ac4-b049-dd805f1da869.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740376934113-d96e9f31-bf47-4e45-9989-b94268413406.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1741933486856-91c022a4-f390-419a-8670-09ae68375629.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1741871423976-162ebe22-bee6-4bb7-b3d6-7fa47c8b74d5.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1741868859617-25b6debe-960e-4b39-be1e-f695fc2f16d1.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740739495462-3ff1ec29-7e69-42b6-a5bb-0a5d5c4eca7e.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1717636015466-e1a69190-bafa-4bae-8f2d-070674173d3e.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1719387281534-76c0bbc8-854e-4d2e-b0a5-2098dc215249.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1719924109530-af392741-38ef-4651-ad08-e25473a9ee08.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1719924324662-967d47e1-3ba4-4750-bd5b-da8ccfc30edf.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1740742642475-2a8fc8ec-d8f0-4b0a-9ef3-f4c7e44fb824.png">
<meta property="og:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1717634860754-37e1ae0c-51c4-4464-8346-65876ff32fde.png">
<meta property="article:published_time" content="2025-03-15T15:25:12.000Z">
<meta property="article:modified_time" content="2025-03-16T00:25:25.986Z">
<meta property="article:author" content="j1ya">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://j1ya-22.github.io/2025/03/15/Pwn-fix/1713404151277-584a9740-d07e-42b8-bb51-f4802e0e89ef.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Pwn_fix - j1ya</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"j1ya-22.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"5oPqGOgpqzM186wdJq3YyrcV-gzGzoHsz","app_key":"tdZv3tC3tP1IszSKxEodRe6e","server_url":null,"path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>j1ya</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Pwn_fix"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-03-15 23:25" pubdate>
          2025年3月15日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          2.1k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          18 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Pwn_fix</h1>
            
            
              <div class="markdown-body">
                
                <p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/13881?time__1311=mqmxnQG=IxyD2DBqDTlxxuGITumAYD&alichlgref=https://cn.bing.com/">https://xz.aliyun.com/t/13881?time__1311=mqmxnQG%3DIxyD2DBqDTlxxuGITumAYD&amp;alichlgref=https%3A%2F%2Fcn.bing.com%2F</a></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python evilPatcher<span class="hljs-selector-class">.py</span> pwn sandboxs/sandbox1<span class="hljs-selector-class">.asm</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<h1 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h1><p>7.7的ida Keypatcher可以直接修改汇编代码，同时undo可以撤销，python3.7不支持apply</p>
<img src="/2025/03/15/Pwn-fix/1713404151277-584a9740-d07e-42b8-bb51-f4802e0e89ef.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1740275445302-3e84cffb-6677-4849-814d-956fcf0372bf.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>8.3的在这里修改汇编代码</p>
<img src="/2025/03/15/Pwn-fix/1724208290255-e435a191-657f-4e3a-8b3e-eb1b2276b9ae.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>有时候会报错</p>
<img src="/2025/03/15/Pwn-fix/1740277743788-533c89f6-3da7-49ca-9b1f-9ca6eeab2418.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>修改完后记得apply</p>
<p>微信传的文件可能只读无法patch成功，bak文件就是原来的，最好还是本地备份一下</p>
<img src="/2025/03/15/Pwn-fix/1717602702582-7b98e378-6857-41bb-9097-b97d2cdae3b3.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h1 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h1><p>经典菜单题目标是free等函数，这里找到关键函数delete进入</p>
<img src="/2025/03/15/Pwn-fix/1687358670407-1734d32e-1624-4ad3-8fb9-761c25ba0408.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>进入该函数后在options处选择general，将number of opcode bytes改为10</p>
<img src="/2025/03/15/Pwn-fix/1687358848340-197f1b42-62fc-4d8c-bc6c-75c907066094.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>在edit中选择patch program，再点apply patch to input files</p>
<h1 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h1><h2 id="栈溢出"><a href="#栈溢出" class="headerlink" title="栈溢出"></a>栈溢出</h2><h3 id="read"><a href="#read" class="headerlink" title="read"></a>read</h3><p><code>read(0,buf,0xe0)</code>这种读得太长会造成栈溢出，修改成较小的一个数比如0x30，修改的数值一般根据当前函数的栈来决定，只要够不到返回地址就可以了</p>
<img src="/2025/03/15/Pwn-fix/1687169579312-afdf55f5-7346-495b-9752-d29d26d176f9.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>类似的函数还有<code>fgets(),getline()</code></p>
<p>有的题目会出现要将0x100以上的数改成0x100以下，就会导致长度不对齐，导致栈空间变化，就需要用nop进行对齐</p>
<p>下面这种栈溢出就不直接</p>
<p>读取base64然后解码放入栈中，没检查size大小，很明显存在栈溢出</p>
<img src="/2025/03/15/Pwn-fix/1741934520520-25d90208-dc16-40ba-995c-1bc48f6c302a.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="scanf"><a href="#scanf" class="headerlink" title="scanf"></a>scanf</h3><img src="/2025/03/15/Pwn-fix/1713489098736-d6a81e9a-8e5a-4a10-9e9f-28f40652305e.png" srcset="/img/loading.gif" lazyload class="" title="img">



<img src="/2025/03/15/Pwn-fix/1713489500925-cd9d9b9c-65e0-46a8-ac71-6af7468a3dd1.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>这里call__isoc99_scanf的PLT，那么在eh_frame上写一个函数，让它call自己写的函数上，而自己写的函数严格限制输入大小，注意这里传入的第二个参数为缓冲区地址</p>
<p>编写如下脚本用于生成字节码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>code = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    xor rdi, rdi</span><br><span class="hljs-string">    mov rdx, 23</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    ret</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(asm(code, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>), end = <span class="hljs-string">&#x27; &#x27;</span>)<br><br><span class="hljs-comment">#48 31 ff 48 c7 c2 17 00 00 00 48 31 c0 0f 05 c3</span><br></code></pre></td></tr></table></figure>

<p>然后去修改 <strong>call scanf</strong></p>
<img src="/2025/03/15/Pwn-fix/1713489501079-12fb76b6-46f8-48a6-b4e1-155b6d71ea5a.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>最后，修改call scanf到call eh_frame上来，由于开了PIE，所以需要call一个相对坐标</p>
<p>先看看原本的地方</p>
<img src="/2025/03/15/Pwn-fix/1713489500935-40532edb-6e95-4ce3-b061-d63aefdbce1c.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>需要把这个函数除了有用的部分全部劫持到在eh_frame上的代码，多余的部分全部改为nop</p>
<img src="/2025/03/15/Pwn-fix/1713489501021-cd672b1f-63bf-4d37-b11c-cbdfd74c8234.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>这是改完以后的，主要就是lea r15, qword_2050这个点，我们需要使用相对寻址来计算目标代码的位置，生成opcode的代码如下，当然也可以直接用keypatch</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br><br>code = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    lea r15, [rip + 0xec5]</span><br><span class="hljs-string">    lea rsi, [rbp - 0x20]</span><br><span class="hljs-string">    call r15</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(asm(code, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;0&#x27;</span>), end = <span class="hljs-string">&#x27; &#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>至于这个 <strong>0xec5</strong> 怎么来的，首先lea的长度为7，所以lea的下一条指令的地址是0x118b，使用0x2050 - 0x118b得到0xec5</p>
<p>但是还有最后的问题，即eh_frame没有执行权限，这个通过IDA修改ELF的头来实现</p>
<img src="/2025/03/15/Pwn-fix/1713489501706-e1ef937c-de3c-445e-aaee-c52af86d3ebf.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>Type一定得是LOAD，而补丁打在第三个LOAD里，所以将Flags修改为7</p>
<img src="/2025/03/15/Pwn-fix/1713489501705-fc60a083-4299-4a63-a270-6a6708dfd8bd.png" srcset="/img/loading.gif" lazyload class="" title="img">



<h3 id="gets-read"><a href="#gets-read" class="headerlink" title="gets-&gt;read"></a>gets-&gt;read</h3><p>把fgets（本地无法编译有gets的程序）改成read，原有的第一行能重复利用</p>
<img src="/2025/03/15/Pwn-fix/1740405874686-76c33a3c-fb8c-4beb-81b5-05fb4376682d.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1740400328044-901bc7ce-65dd-4e70-a0e7-35a509172669.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>写完后续的gadget之后再跳转回去</p>
<img src="/2025/03/15/Pwn-fix/1740400380530-1754c3ab-c3cb-48eb-a3fd-a145fe2b5ca1.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>最终效果</p>
<img src="/2025/03/15/Pwn-fix/1740405863303-64225fc5-002c-4eb6-8367-6efadd7362da.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>注意还需要改eh_frame的权限</p>
<p>用ida在第一个load段找到type为eh_frame的flags标志</p>
<img src="/2025/03/15/Pwn-fix/1740450657032-b9f6c1ab-e151-456b-810a-0fe54e57f547.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>也可以用010按下面的方式找到标志位修改eh_frame权限</p>
<img src="/2025/03/15/Pwn-fix/1740405657726-833c2835-10f8-49b3-b620-e9a1f2ea8f3c.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1740405674980-fb09c9d7-b87a-4888-a30a-8e95f2ac7481.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1740405480305-8970392f-4ad9-4ae6-8cf1-e7261d219fdb.png" srcset="/img/loading.gif" lazyload class="" title="img">



<h2 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h2><p>最开始存在漏洞</p>
<img src="/2025/03/15/Pwn-fix/1710549753112-ca4a6f18-a929-44ee-a59c-f24070436a1b.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>一般挑选eh_frame段（存储程序的调试信息和堆栈回溯相关的信息）的某处，改为0x25和0x73</p>
<img src="/2025/03/15/Pwn-fix/1710501367023-420e8800-9c4e-4c92-a4e7-13f8edac75fe.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>按a转为字符串</p>
<img src="/2025/03/15/Pwn-fix/1710501499855-a8f32303-73be-4e61-8300-4337962359bc.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>原来只有一个参数，现在要修改成两个</p>
<img src="/2025/03/15/Pwn-fix/1710501858792-a23418bd-2aad-41b9-a1c0-ee71172c6d15.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>修改字节的时候要保持和原来的长度一样</p>
<p>如果开了pie，mov edi 0x402130要变成lea rdi, [rip + 0x2150]，rip是下一条指令的地址，在这里就不太好修了</p>
<img src="/2025/03/15/Pwn-fix/1740277559808-41de466f-a00f-466f-8f79-22b92d450523.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>最后的效果</p>
<img src="/2025/03/15/Pwn-fix/1710549682047-f28357c2-b925-44d7-a7ba-99bfdd87d5fc.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h3 id="printf-puts-printf-chk"><a href="#printf-puts-printf-chk" class="headerlink" title="printf-&gt;puts&#x2F;printf_chk"></a>printf-&gt;puts&#x2F;printf_chk</h3><p>可以将printf修改为puts，前提是要有puts函数，但是程序多了一个回车可能check不过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> lief<br><br><span class="hljs-comment"># 解析二进制文件</span><br>binary = lief.parse(sys.argv[<span class="hljs-number">1</span>])<br><br><span class="hljs-comment"># 查找 printf 动态符号并修改其名称为 puts</span><br>puts_sym = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> e: e.name == <span class="hljs-string">&quot;printf&quot;</span>, binary.dynamic_symbols))[<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># 修改符号名称为 puts</span><br>puts_sym.name = <span class="hljs-string">&quot;puts&quot;</span><br><br><span class="hljs-comment"># 写入修改后的二进制文件</span><br>binary.write(<span class="hljs-string">&quot;patch&quot;</span>)<br></code></pre></td></tr></table></figure>



<p>不过这样其实还是有问题，因为这里使用的是puts，它比printf短，那如果需要替换为__printf_chk呢？还是使用到了eh_frame段，主要是因为这个段一般用不到，不会影响程序正常运行</p>
<img src="/2025/03/15/Pwn-fix/1713489915539-febdc2eb-43d0-4f49-9889-ec8304a2b348.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>然后修改printf到这里来 0x2060 - 0x488 &#x3D; 0x1bd8</p>
<img src="/2025/03/15/Pwn-fix/1713489915459-f26e378a-c77b-463f-b24f-55624c4d57a2.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>最后执行 <img src="/2025/03/15/Pwn-fix/1713489915481-955f1161-a9c0-4deb-ac6a-d23cd5c86e41.png" srcset="/img/loading.gif" lazyload class="" title="img"></p>
<p>虽然说报错了，但是可以发现报错信息只是说找不到这个符号，替换还是正确的，换成别的函数是没问题的，只是IDA这个地方会报错</p>
<h2 id="整数溢出"><a href="#整数溢出" class="headerlink" title="整数溢出"></a>整数溢出</h2><p>从 scanf 读入一个负数时，最高位为 1 ，从 unsigned int 强制转换为 int ，结果是负数，必定比 48 小，在后面 read 读入会造成栈溢出</p>
<img src="/2025/03/15/Pwn-fix/1711270889039-b1ecb5f5-30f2-4ef9-b60f-b60769e4af42.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>把原来有符号的jle改为无符号的jbe</p>
<p>有时候不一定有明显的强制类型转换</p>
<p>前面是int</p>
<img src="/2025/03/15/Pwn-fix/1721099776048-002d4306-f46e-4e8a-9bea-641838f0b660.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>函数内部变成unsigned int</p>
<img src="/2025/03/15/Pwn-fix/1721099808872-50215e30-3ddc-405b-8453-7c750ec14a97.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="修改偏移"><a href="#修改偏移" class="headerlink" title="修改偏移"></a>修改偏移</h2><p>fix前可以任意地址访问</p>
<img src="/2025/03/15/Pwn-fix/1721031940652-1cb20ae6-b66f-4469-ad36-0730ca046713.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>fix后就只能在双地址了</p>
<img src="/2025/03/15/Pwn-fix/1721032005547-95837619-6c0f-4f8a-bf21-59de84091ea9.png" srcset="/img/loading.gif" lazyload class="" title="img">



<p>getflag部分+4改成+8</p>
<img src="/2025/03/15/Pwn-fix/1741921914741-4845f033-abeb-4e4b-8786-1fcdc74b405a.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>其他方法不行的时候也是一种方法</p>
<h2 id="修改if范围"><a href="#修改if范围" class="headerlink" title="修改if范围"></a>修改if范围</h2><p>假设需要将图上第二个 if 放到 if 结构内，修改跳转的地址即可：</p>
<img src="/2025/03/15/Pwn-fix/1713406214307-76909e37-d204-42cd-b88d-1cee41bba374.jpeg" srcset="/img/loading.gif" lazyload class="" title="img">

<p>原始跳转代码：</p>
<img src="/2025/03/15/Pwn-fix/1713406214189-2625844a-f628-40e2-ba1c-d4322999bc01.jpeg" srcset="/img/loading.gif" lazyload class="" title="img">

<p>js 0x40081C –&gt; js 0x400845</p>
<img src="/2025/03/15/Pwn-fix/1713406214196-88d68a78-25c5-4527-b037-c765fb0339d4.jpeg" srcset="/img/loading.gif" lazyload class="" title="img">



<h3 id="对同一个参数多次限制"><a href="#对同一个参数多次限制" class="headerlink" title="对同一个参数多次限制"></a>对同一个参数多次限制</h3><p>当v2刚好等于128时，v5会是一个未被赋值的悬挂指针，然后再下一次使用password认证，就能劫持到该指针，造成任意内存写</p>
<img src="/2025/03/15/Pwn-fix/1740742873574-0e31fbc0-0b3e-4f59-9963-647ec1c9f128.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h1 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h1><h2 id="UAF"><a href="#UAF" class="headerlink" title="UAF"></a>UAF</h2><p>删除指针后未将指针置空造成该漏洞</p>
<p><a target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/7z/35612767/1740473789285-cd30770e-7adf-4ec2-a333-517c4d978de0.7z">📎uaf.7z</a></p>
<p>原来的程序</p>
<img src="/2025/03/15/Pwn-fix/1740466819436-38f263ec-70ca-41f2-871e-1303b4e6b6fa.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>先把call free改成jmp 0x8048b64，上面的代码不动防止破坏栈结构</p>
<img src="/2025/03/15/Pwn-fix/1740467059859-2ffbd8e9-b9f6-47b9-85d7-0373c7b58b52.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1741865511685-a08bd76f-d6a6-455a-a2ef-86382512190a.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>主要逻辑是按照原有的代码来，就只改变一行，然后跳回到正常代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">call <span class="hljs-number">0x80484a0</span><br>mov eax,dword ptr [ebp-<span class="hljs-number">0x10</span>]<br>mov dword ptr ds:page[eax*<span class="hljs-number">4</span>],<span class="hljs-number">0</span><span class="hljs-comment">#fix uaf</span><br>jmp <span class="hljs-number">0x8048934</span><br></code></pre></td></tr></table></figure>

<p>最终的效果</p>
<img src="/2025/03/15/Pwn-fix/1740453092636-6f14668b-2da6-4cde-9117-ca2406adca32.png" srcset="/img/loading.gif" lazyload class="" title="img">



<p><a target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/7z/35612767/1740473712904-bdd210d8-f179-47d5-9ae5-75983fde9d25.7z">📎pwn_patch.7z</a></p>
<img src="/2025/03/15/Pwn-fix/1740467452039-30ba8060-8897-4919-a769-c4e8588b6611.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1740467472685-a4eab699-7f59-4c01-898c-291cc571b46e.png" srcset="/img/loading.gif" lazyload class="" title="img">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">call <span class="hljs-number">0x920</span><br>mov rax,<span class="hljs-number">0</span><br>jmp <span class="hljs-number">0x16a8</span><br></code></pre></td></tr></table></figure>

<p>按照上面的代码基本没变化</p>
<img src="/2025/03/15/Pwn-fix/1740467957703-00404bec-9785-4e50-a700-3b8cca613cd5.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>按照free之前的代码能得到正确结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">call <span class="hljs-number">0x920</span><br>mov eax,[rbp+<span class="hljs-number">4</span>]<br>movsxd rdx,eax<br>mov rax,rdx<br>shl rax,<span class="hljs-number">2</span><br>add rax,rdx<br>shl rax,<span class="hljs-number">3</span><br>mov rdx,rax<br>lea rax,qword ptr [<span class="hljs-number">0x203080</span>]<br>mov qword ptr [rax+rdx],<span class="hljs-number">0</span><br>jmp <span class="hljs-number">0x16a8</span><br></code></pre></td></tr></table></figure>

<img src="/2025/03/15/Pwn-fix/1740473504405-e31668e4-4964-4c6d-91b0-56bca33f588b.png" srcset="/img/loading.gif" lazyload class="" title="img">



<p>下面这种3字节的汇编指令，stosd将 eax 的值存储到 [edi] 指向的内存地址，有概率fix</p>
<p>xor eax,eax;stosd</p>
<h2 id="off-by-one"><a href="#off-by-one" class="headerlink" title="off by one"></a>off by one</h2><h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><p>溢出一个字节，此时当输入17个字符的垃圾数据后，便可以通过溢出的一个字节覆盖使printf能够泄露之后的数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> a[<span class="hljs-number">16</span>];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">16</span>;i++)<br>    &#123;<br>        read(<span class="hljs-number">0</span>,a+i,<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>,a);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="字符串操作函数"><a href="#字符串操作函数" class="headerlink" title="字符串操作函数"></a>字符串操作函数</h3><p>还有strcmp, puts, gets等, 遇到\x00才会截断</p>
<h4 id="strcpy"><a href="#strcpy" class="headerlink" title="strcpy"></a>strcpy</h4><p>strcpy函数在拷贝的时候也会将结束符\x00存入堆块中，也就是说向chunk1中一共写了25个字节，这就导致chunk1溢出了一个字节</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">char</span> buffer[<span class="hljs-number">40</span>]=<span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-type">void</span> *chunk1;<br>    chunk1=<span class="hljs-built_in">malloc</span>(<span class="hljs-number">24</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Get Input&quot;</span>);<br>    gets(buffer);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">strlen</span>(buffer)==<span class="hljs-number">24</span>)<br>    &#123;<br>        <span class="hljs-built_in">strcpy</span>(chunk1,buffer);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="strlen"><a href="#strlen" class="headerlink" title="strlen*"></a>strlen*</h4><p>如果将下一个相邻的 chunk 的 prev size 填满，那么 strlen 计算的时候就会算上下一个相邻 chunk 的 size 头的8字节，后续就可以修改下一个相邻 chunk 的 size</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">__int64 __fastcall edit(__int64 a1)<br>&#123;<br>  unsigned <span class="hljs-built_in">int</span> v2; // [rsp+1Ch] [rbp-4h]<br><br>  printf(<span class="hljs-string">&quot;Input the Index of Note:&quot;</span>);<br>  v2 = read();<br>  <span class="hljs-keyword">if</span> ( sub_400B04(v2, a1) != <span class="hljs-number">1</span> )<br>  &#123;<br>    printf(<span class="hljs-string">&quot;Invaild !!&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    printf(<span class="hljs-string">&quot;Input the Note:&quot;</span>);<br>    read1(*(8LL * v2 + a1), *(<span class="hljs-number">8</span> * (v2 + 16LL) + a1));<br>    *(a1 + <span class="hljs-number">8</span> * (v2 + 16LL)) = strlen(*(8LL * v2 + a1));<br>    printf(<span class="hljs-string">&quot;Edit Done!&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> 0LL;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>下面是strlen的部分源码，根据下面的代码猜测是库函数，也可以调试去查看效果</p>
<img src="/2025/03/15/Pwn-fix/1739065756868-39cad9f0-0116-4884-a5e0-a6dee089e627.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="off-by-null"><a href="#off-by-null" class="headerlink" title="off by null"></a>off by null</h2><p>长度的检查不严谨导致了一个空字节的溢出造成的，off by null溢出的是NULL字节即’\x00’</p>
<p>直接nop置零操作</p>
<img src="/2025/03/15/Pwn-fix/1717775588631-e897367d-b5cb-4ac4-b049-dd805f1da869.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1740376934113-d96e9f31-bf47-4e45-9989-b94268413406.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1741933486856-91c022a4-f390-419a-8670-09ae68375629.png" srcset="/img/loading.gif" lazyload class="" title="img">



<h2 id="memcpy"><a href="#memcpy" class="headerlink" title="memcpy"></a>memcpy</h2><p>一般memcpy容易造成溢出</p>
<img src="/2025/03/15/Pwn-fix/1741871423976-162ebe22-bee6-4bb7-b3d6-7fa47c8b74d5.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>存在堆溢出，输入的时候小于1024即可，但是qword_A080[a1]类型为qword</p>
<img src="/2025/03/15/Pwn-fix/1741868859617-25b6debe-960e-4b39-be1e-f695fc2f16d1.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="relloc-calloc"><a href="#relloc-calloc" class="headerlink" title="relloc-&gt;calloc"></a>relloc-&gt;calloc</h2><p>realloc 函数身兼 malloc 和 free 两个函数的功能，calloc 与 malloc 的区别是 calloc 在分配后会自动进行清空</p>
<p>按照上面printf-&gt;puts的方法运行脚本即可</p>
<img src="/2025/03/15/Pwn-fix/1740739495462-3ff1ec29-7e69-42b6-a5bb-0a5d5c4eca7e.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="0xfff泄露堆地址"><a href="#0xfff泄露堆地址" class="headerlink" title="&amp;0xfff泄露堆地址"></a>&amp;0xfff泄露堆地址</h2><p>这种&amp;0xfff的大概率在泄露堆地址，可以改为0xffc</p>
<p>还有一种是改malloc的size，</p>
<img src="/2025/03/15/Pwn-fix/1717636015466-e1a69190-bafa-4bae-8f2d-070674173d3e.png" srcset="/img/loading.gif" lazyload class="" title="img">

<h2 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h2><p>十个强制类型转换九个有问题，这里要改成大于等于，因为等于的时候能修改下一个heap的size位</p>
<img src="/2025/03/15/Pwn-fix/1719387281534-76c0bbc8-854e-4d2e-b0a5-2098dc215249.png" srcset="/img/loading.gif" lazyload class="" title="img">



<h2 id="相同数字造成堆叠"><a href="#相同数字造成堆叠" class="headerlink" title="相同数字造成堆叠"></a>相同数字造成堆叠</h2><p>init最大malloc是0x4f+1</p>
<img src="/2025/03/15/Pwn-fix/1719924109530-af392741-38ef-4651-ad08-e25473a9ee08.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>add函数最小也是0x4f+1，这个时候会造成堆叠</p>
<img src="/2025/03/15/Pwn-fix/1719924324662-967d47e1-3ba4-4750-bd5b-da8ccfc30edf.png" srcset="/img/loading.gif" lazyload class="" title="img">

<p>这时候要把前面的+1改成+0</p>
<h2 id="堆的通修"><a href="#堆的通修" class="headerlink" title="堆的通修"></a>堆的通修</h2><p>nop free或者<strong>nop exit</strong>这样的做法有时候在比赛中比较管用，但也不是啥时候都管用，因此还有另外的方案</p>
<p>现在的PWN题运行过程动不动就有个 5s 以上（比如说要打IO爆破），而checker的运行只有短短 1~5 秒，那么可以patch程序最开始的 alarm(60) 为 alarm(5)，这样就有可能造成check通过而exp不通过，从而通过check逻辑</p>
<img src="/2025/03/15/Pwn-fix/1740742642475-2a8fc8ec-d8f0-4b0a-9ef3-f4c7e44fb824.png" srcset="/img/loading.gif" lazyload class="" title="img">

<img src="/2025/03/15/Pwn-fix/1717634860754-37e1ae0c-51c4-4464-8346-65876ff32fde.png" srcset="/img/loading.gif" lazyload class="" title="img">

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Pwn_fix</div>
      <div>https://j1ya-22.github.io/2025/03/15/Pwn-fix/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>j1ya</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年3月15日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/03/15/ciscn2024%E5%90%84%E8%B5%9B%E5%8C%BA%E5%8D%8A%E5%86%B3%E8%B5%9B/" title="ciscn2024各赛区半决赛">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ciscn2024各赛区半决赛</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/03/10/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9Cinitial-wp/" title="春秋云镜initial wp">
                        <span class="hidden-mobile">春秋云镜initial wp</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"5oPqGOgpqzM186wdJq3YyrcV-gzGzoHsz","appKey":"tdZv3tC3tP1IszSKxEodRe6e","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
